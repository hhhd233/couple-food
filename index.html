<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ğŸ’• ä»Šå¤©åƒä»€ä¹ˆ</title>
<meta name="theme-color" content="#ff6b81">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="ä»Šå¤©åƒä»€ä¹ˆ">
<link rel="manifest" href="manifest.json">
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap');
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',-apple-system,sans-serif;}
:root{
  --pink:#ff6b81;--pink-light:#fff0f3;--pink-mid:#ffd6dd;
  --green:#9EB5A3;--gray:#666;--shadow:0 4px 16px rgba(255,107,129,0.15);
}
body{background:#fff7f9;min-height:100vh;}

/* é¡¶æ  */
header{
  background:linear-gradient(135deg,#ff6b81,#ff8fa3);
  color:white;padding:14px 18px;
  display:flex;justify-content:space-between;align-items:center;
  box-shadow:0 2px 12px rgba(255,107,129,0.3);
  position:sticky;top:0;z-index:100;
}
.logo{font-size:18px;font-weight:600;}
.header-btns{display:flex;gap:8px;}
.header-btns button{
  background:rgba(255,255,255,0.2);color:white;
  border:1px solid rgba(255,255,255,0.4);
  padding:6px 12px;border-radius:20px;cursor:pointer;font-size:12px;
  transition:all 0.2s;
}
.header-btns button:hover{background:rgba(255,255,255,0.35);}

/* ä¸»ä½“ */
#app{padding:16px;max-width:540px;margin:0 auto;}

/* æ¨¡å¼åˆ‡æ¢ */
.mode-tabs{
  display:flex;background:white;border-radius:14px;
  padding:4px;margin-bottom:14px;box-shadow:var(--shadow);
}
.mode-tab{
  flex:1;padding:10px;border:none;background:transparent;
  border-radius:10px;cursor:pointer;font-size:14px;font-weight:500;
  color:var(--gray);transition:all 0.25s;
}
.mode-tab.active{
  background:linear-gradient(135deg,#ff6b81,#ff8fa3);
  color:white;box-shadow:0 2px 8px rgba(255,107,129,0.35);
}

/* å¡ç‰‡ */
.card{
  background:white;border-radius:16px;padding:18px;
  margin-bottom:14px;box-shadow:var(--shadow);
}
.card-title{font-size:15px;font-weight:600;color:#333;margin-bottom:12px;}

/* æŒ‰é’® */
.btn{
  width:100%;padding:13px;border:none;border-radius:12px;
  cursor:pointer;font-size:14px;font-weight:600;
  transition:all 0.25s;display:flex;align-items:center;
  justify-content:center;gap:6px;
}
.btn-primary{
  background:linear-gradient(135deg,#ff6b81,#ff8fa3);
  color:white;box-shadow:0 4px 14px rgba(255,107,129,0.35);
}
.btn-primary:hover{transform:translateY(-1px);}
.btn-primary:active{transform:translateY(0);}
.btn-secondary{background:white;color:var(--pink);border:2px solid var(--pink-mid);margin-top:8px;}
.btn-secondary:hover{background:var(--pink-light);}

/* å®šä½æ  */
.location-bar{
  display:flex;align-items:center;gap:8px;
  background:var(--pink-light);border-radius:10px;
  padding:10px 12px;margin-bottom:14px;font-size:13px;color:var(--gray);
}
.loc-dot{
  width:8px;height:8px;border-radius:50%;background:#ccc;
  flex-shrink:0;transition:background 0.3s;
}
.loc-dot.ok{background:#4caf50;}
.loc-dot.spin{background:#ff9800;animation:pulse 1s infinite;}
.loc-dot.fail{background:#f44336;}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}
.loc-refresh{
  margin-left:auto;background:none;border:none;
  color:var(--pink);cursor:pointer;font-size:17px;
  padding:2px 6px;border-radius:6px;
}
.loc-refresh:hover{background:var(--pink-mid);}

/* ç”¨é¤æ–¹å¼å¡ç‰‡ */
.meal-card{
  background:white;border-radius:16px;padding:20px;
  margin-bottom:14px;box-shadow:var(--shadow);cursor:pointer;
  display:flex;align-items:center;gap:14px;transition:all 0.25s;
}
.meal-card:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(255,107,129,0.2);}
.meal-icon{font-size:38px;flex-shrink:0;}
.meal-info{flex:1;}
.meal-title{font-size:16px;font-weight:600;color:#333;}
.meal-desc{font-size:12px;color:#999;margin-top:4px;line-height:1.5;}
.meal-arrow{color:#ddd;font-size:20px;flex-shrink:0;}

/* èœç³»ç­›é€‰æ ‡ç­¾ */
.cuisine-filter{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:14px;}
.ctag{
  padding:6px 12px;border-radius:20px;border:2px solid var(--pink-mid);
  background:white;font-size:12px;cursor:pointer;transition:all 0.2s;color:var(--gray);
}
.ctag.active{background:var(--pink);color:white;border-color:var(--pink);}

/* åŸå¸‚ç½‘æ ¼ */
.city-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:10px;}
.city-btn{
  padding:10px 6px;border:2px solid var(--pink-mid);background:white;
  border-radius:10px;cursor:pointer;font-size:13px;transition:all 0.2s;color:#333;
}
.city-btn:hover,.city-btn.active{background:var(--pink);color:white;border-color:var(--pink);}

/* é¤å…ç»“æœ */
.poi-group{margin-bottom:16px;}
.poi-group-title{
  font-size:14px;font-weight:600;color:#333;
  margin-bottom:10px;display:flex;align-items:center;gap:6px;
}
.poi-count{
  background:var(--pink-light);color:var(--pink);
  font-size:11px;padding:2px 8px;border-radius:10px;
}
.poi-item{
  background:white;border-radius:12px;padding:14px;
  margin-bottom:10px;box-shadow:0 2px 10px rgba(0,0,0,0.06);
  transition:all 0.2s;
}
.poi-item:hover{transform:translateY(-1px);box-shadow:0 4px 14px rgba(0,0,0,0.1);}
.poi-name{font-size:15px;font-weight:600;color:#333;margin-bottom:6px;}
.poi-addr{font-size:12px;color:#999;margin-bottom:8px;line-height:1.5;}
.poi-actions{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
.poi-actions a{
  padding:9px;border-radius:8px;text-decoration:none;
  font-size:12px;font-weight:600;display:flex;
  align-items:center;justify-content:center;gap:4px;transition:all 0.2s;
}
.a-mt{background:#FFD100;color:#333;}
.a-mt:hover{background:#ffc800;}
.a-el{background:#0089FF;color:white;}
.a-el:hover{background:#007ae0;}

/* èœè°± */
.recipe-item{
  background:white;border-radius:12px;padding:16px;
  margin-bottom:12px;box-shadow:0 2px 10px rgba(0,0,0,0.06);
}
.recipe-name{font-size:16px;font-weight:600;color:#333;margin-bottom:10px;}
.recipe-badges{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px;}
.badge{padding:3px 8px;border-radius:8px;font-size:11px;font-weight:500;}
.b-time{background:#fff3e0;color:#e65100;}
.b-diff{background:#e8f5e9;color:#2e7d32;}
.b-spicy{background:#fce4ec;color:#c62828;}
.b-match{background:var(--pink-light);color:var(--pink);}
.recipe-toggle{
  width:100%;padding:9px;border:2px solid var(--pink-mid);
  background:white;border-radius:8px;cursor:pointer;
  font-size:13px;color:var(--pink);font-weight:500;transition:all 0.2s;
}
.recipe-toggle:hover{background:var(--pink-light);}
.recipe-detail{display:none;margin-top:12px;padding-top:12px;border-top:1px dashed var(--pink-mid);}
.recipe-detail.open{display:block;}
.recipe-section{margin-bottom:14px;}
.recipe-section h4{font-size:13px;color:#333;margin-bottom:8px;font-weight:600;}
.recipe-section li{
  font-size:13px;color:var(--gray);line-height:1.9;
  padding-left:14px;position:relative;list-style:none;
}
.recipe-section li::before{content:"â€¢";position:absolute;left:0;color:var(--pink);}
.recipe-tip{
  background:#fff8e1;border-left:3px solid #ffc107;
  padding:10px 12px;border-radius:0 8px 8px 0;
  font-size:12px;color:#666;line-height:1.6;
}

/* åå¥½è®¾ç½® */
.pref-section{margin-bottom:18px;}
.pref-section label{display:block;font-size:13px;font-weight:600;color:#333;margin-bottom:8px;}
.pref-section select{
  width:100%;padding:10px 12px;border:2px solid #ddd;
  border-radius:10px;font-size:14px;color:#333;background:white;
}
.pref-options{display:flex;flex-wrap:wrap;gap:8px;}
.pref-btn{
  padding:7px 14px;border:2px solid #ddd;background:white;
  border-radius:10px;cursor:pointer;font-size:13px;transition:all 0.2s;color:#333;
}
.pref-btn.selected{background:var(--pink);color:white;border-color:var(--pink);}

/* å¼¹çª— */
.modal{
  display:none;position:fixed;inset:0;
  background:rgba(0,0,0,0.45);z-index:999;
  align-items:flex-end;justify-content:center;
}
.modal.show{display:flex;}
.modal-box{
  background:white;border-radius:24px 24px 0 0;
  padding:28px 20px 40px;width:100%;max-width:540px;
  max-height:88vh;overflow-y:auto;animation:slideUp 0.3s ease;
}
@keyframes slideUp{from{transform:translateY(60px);opacity:0}to{transform:translateY(0);opacity:1}}
.modal-handle{
  width:40px;height:4px;background:#ddd;
  border-radius:2px;margin:0 auto 20px;
}
.modal-title{font-size:18px;font-weight:600;color:#333;margin-bottom:20px;}

/* é€‰æ‹©å›°éš¾å¼¹çª— */
.giveup-modal{align-items:center;padding:20px;}
.giveup-box{
  background:white;border-radius:24px;padding:32px 24px;
  max-width:360px;width:100%;text-align:center;
  animation:popIn 0.3s cubic-bezier(.34,1.56,.64,1);
}
@keyframes popIn{from{transform:scale(0.8);opacity:0}to{transform:scale(1);opacity:1}}
.giveup-emoji{font-size:64px;margin-bottom:16px;display:block;animation:wobble 0.6s ease;}
@keyframes wobble{0%,100%{transform:rotate(0)}25%{transform:rotate(-10deg)}75%{transform:rotate(10deg)}}
.giveup-title{font-size:20px;font-weight:600;color:#333;margin-bottom:10px;}
.giveup-text{font-size:14px;color:#888;line-height:1.8;margin-bottom:24px;}

/* æ‚é¡¹ */
.counter{text-align:center;font-size:12px;color:#bbb;margin-top:6px;}
.loading{text-align:center;padding:32px;color:#aaa;font-size:14px;}
.empty{text-align:center;padding:40px 20px;color:#bbb;font-size:14px;}
input.text-input{
  width:100%;padding:10px 12px;border:2px solid #eee;
  border-radius:10px;font-size:14px;margin-top:8px;
}
</style>
</head>
<body>

<!-- é¡¶æ  -->
<header>
  <div class="logo">ğŸ’• ä»Šå¤©åƒä»€ä¹ˆ</div>
  <div class="header-btns">
    <button onclick="openSettings()">âš™ï¸ åå¥½</button>
    <button onclick="resetApiKey()">ğŸ”‘ Key</button>
  </div>
</header>

<div id="app">

  <!-- æ¨¡å¼åˆ‡æ¢ -->
  <div class="mode-tabs">
    <button class="mode-tab active" onclick="switchMode('couple',this)">ğŸ’‘ åŒäººæ¨¡å¼</button>
    <button class="mode-tab" onclick="switchMode('solo',this)">ğŸ§‘ å•äººæ¨¡å¼</button>
  </div>

  <!-- å®šä½æ  -->
  <div class="location-bar">
    <div class="loc-dot" id="locDot"></div>
    <span id="locText">å‡†å¤‡å®šä½...</span>
    <button class="loc-refresh" onclick="getLocation()" title="åˆ·æ–°å®šä½">â†»</button>
  </div>

  <!-- é¦–é¡µï¼šé€‰æ‹©ç”¨é¤æ–¹å¼ -->
  <div id="homeSection">
    <div class="meal-card" onclick="showTakeout()">
      <div class="meal-icon">ğŸ›µ</div>
      <div class="meal-info">
        <div class="meal-title">ç‚¹å¤–å–</div>
        <div class="meal-desc">æœç´¢é™„è¿‘çœŸå®é¤å…ï¼ŒæŒ‰èœç³»åˆ†ç±»<br>ä¸€é”®è·³è½¬ç¾å›¢ / é¥¿äº†ä¹ˆä¸‹å•</div>
      </div>
      <div class="meal-arrow">â€º</div>
    </div>
    <div class="meal-card" onclick="showCooking()">
      <div class="meal-icon">ğŸ³</div>
      <div class="meal-info">
        <div class="meal-title">åœ¨å®¶åš</div>
        <div class="meal-desc">æ ¹æ®å®¶ä¹¡æ¨èå®¶å¸¸èœ<br>è¯¦ç»†é£Ÿæ + æ­¥éª¤ + å°è´´å£«</div>
      </div>
      <div class="meal-arrow">â€º</div>
    </div>
  </div>

  <!-- å¤–å–åŒºåŸŸ -->
  <div id="takeoutSection" style="display:none;">
    <button class="btn btn-secondary" onclick="backHome()">â† è¿”å›</button>

    <!-- æ— å®šä½æ—¶æ˜¾ç¤ºåŸå¸‚é€‰æ‹© -->
    <div id="citySection" class="card" style="display:none;margin-top:14px;">
      <div class="card-title">ğŸ“ å®šä½å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©åŸå¸‚</div>
      <div class="city-grid">
        <button class="city-btn" onclick="pickCity('å—å®',this)">å—å®</button>
        <button class="city-btn" onclick="pickCity('åŒ—äº¬',this)">åŒ—äº¬</button>
        <button class="city-btn" onclick="pickCity('ä¸Šæµ·',this)">ä¸Šæµ·</button>
        <button class="city-btn" onclick="pickCity('å¹¿å·',this)">å¹¿å·</button>
        <button class="city-btn" onclick="pickCity('æ·±åœ³',this)">æ·±åœ³</button>
        <button class="city-btn" onclick="pickCity('æˆéƒ½',this)">æˆéƒ½</button>
        <button class="city-btn" onclick="pickCity('æ­¦æ±‰',this)">æ­¦æ±‰</button>
        <button class="city-btn" onclick="pickCity('æ­å·',this)">æ­å·</button>
      </div>
      <input id="customCity" class="text-input" placeholder="æˆ–è¾“å…¥å…¶ä»–åŸå¸‚åç§°">
      <button class="btn btn-primary" style="margin-top:10px;" onclick="useCustomCity()">ä½¿ç”¨æ­¤åŸå¸‚æœç´¢</button>
    </div>

    <!-- æœç´¢é¢æ¿ -->
    <div class="card" style="margin-top:14px;" id="searchPanel">
      <div class="card-title">ğŸ” é€‰æ‹©èœç³»</div>
      <div class="cuisine-filter" id="cuisineFilter">
        <span class="ctag active" onclick="pickCuisine(this,'é¤å…')">ğŸ½ å…¨éƒ¨</span>
        <span class="ctag" onclick="pickCuisine(this,'ç«é”…')">ğŸ² ç«é”…</span>
        <span class="ctag" onclick="pickCuisine(this,'çƒ§çƒ¤')">ğŸ– çƒ§çƒ¤</span>
        <span class="ctag" onclick="pickCuisine(this,'æ—¥æ–™')">ğŸ£ æ—¥æ–™</span>
        <span class="ctag" onclick="pickCuisine(this,'å¿«é¤')">ğŸ” å¿«é¤</span>
        <span class="ctag" onclick="pickCuisine(this,'ç²¥ç²‰é¢')">ğŸœ ç²¥ç²‰é¢</span>
        <span class="ctag" onclick="pickCuisine(this,'è½»é£Ÿ')">ğŸ¥— è½»é£Ÿ</span>
        <span class="ctag" onclick="pickCuisine(this,'éº»è¾£çƒ«')">ğŸŒ¶ éº»è¾£çƒ«</span>
        <span class="ctag" onclick="pickCuisine(this,'çƒ§è…Š')">ğŸ— çƒ§è…Š</span>
      </div>
      <button class="btn btn-primary" onclick="searchFood()">ğŸ” æœç´¢é™„è¿‘é¤å…</button>
      <div class="counter" id="searchCounter"></div>
    </div>

    <div id="takeoutResult"></div>
  </div>

  <!-- åœ¨å®¶åšåŒºåŸŸ -->
  <div id="cookingSection" style="display:none;">
    <button class="btn btn-secondary" onclick="backHome()">â† è¿”å›</button>
    <div class="card" style="margin-top:14px;">
      <div class="card-title">
        ğŸ³ <span id="provinceLabel">å®¶å¸¸èœ</span>æ¨è
      </div>
      <button class="btn btn-primary" onclick="showRecipes()">âœ¨ å¸®æˆ‘æ¨èä»Šå¤©åšä»€ä¹ˆ</button>
      <div class="counter" id="recipeCounter"></div>
    </div>
    <div id="recipeResult"></div>
  </div>

</div>

<!-- â”€â”€ åå¥½è®¾ç½®å¼¹çª— â”€â”€ -->
<div class="modal" id="settingsModal">
  <div class="modal-box">
    <div class="modal-handle"></div>
    <div class="modal-title">âš™ï¸ åå¥½è®¾ç½®</div>
    <div class="pref-section">
      <label>ğŸ  å®¶ä¹¡ï¼ˆå½±å“åœ¨å®¶åšæ¨èï¼‰</label>
      <select id="prefProvince" onchange="quickSaveProvince()">
        <option value="">è¯·é€‰æ‹©</option>
        <option value="å·æ¸">å·æ¸ï¼ˆå››å·/é‡åº†ï¼‰</option>
        <option value="å¹¿ä¸œ">å¹¿ä¸œ</option>
        <option value="å¹¿è¥¿">å¹¿è¥¿</option>
        <option value="æ±Ÿæµ™æ²ª">æ±Ÿæµ™æ²ª</option>
        <option value="æ¹–å—">æ¹–å—</option>
        <option value="æ¹–åŒ—">æ¹–åŒ—</option>
        <option value="ç¦å»º">ç¦å»º</option>
        <option value="äº‘å—">äº‘å—</option>
        <option value="ä¸œåŒ—">ä¸œåŒ—</option>
        <option value="å±±ä¸œ">å±±ä¸œ</option>
        <option value="é™•è¥¿">é™•è¥¿</option>
        <option value="åŒ—æ–¹">åŒ—æ–¹ï¼ˆäº¬æ´¥å†€ï¼‰</option>
      </select>
    </div>
    <div class="pref-section">
      <label>ğŸš« ä¸åƒçš„é£Ÿæ</label>
      <div class="pref-options" id="prefDislikes"></div>
    </div>
    <div class="pref-section">
      <label>ğŸŒ¶ï¸ è¾£åº¦åå¥½</label>
      <div class="pref-options" id="prefSpicy"></div>
    </div>
    <div class="pref-section">
      <label>ğŸ¯ é¥®é£Ÿç›®æ ‡</label>
      <div class="pref-options" id="prefDiet"></div>
    </div>
    <button class="btn btn-primary" onclick="saveSettings()">ğŸ’¾ ä¿å­˜è®¾ç½®</button>
    <button class="btn btn-secondary" onclick="closeSettings()">å–æ¶ˆ</button>
  </div>
</div>

<!-- â”€â”€ é€‰æ‹©å›°éš¾å¼¹çª— â”€â”€ -->
<div class="modal giveup-modal" id="giveupModal">
  <div class="giveup-box">
    <span class="giveup-emoji">ğŸ˜­</span>
    <div class="giveup-title">é€‰æ‹©å›°éš¾ç—‡å‘ä½œå•¦ï¼</div>
    <div class="giveup-text">
      å·²ç»æ¢äº† <strong id="giveupCount">4</strong> æ¬¡äº†...<br>
      äººå®¶çœŸçš„å°½åŠ›äº†å‘¢ (ï½¡â€¢Ìï¸¿â€¢Ì€ï½¡)<br>
      è¦ä¸è®©ç³»ç»Ÿå¸®ä½ ä»¬éšæœºå†³å®šï¼Ÿ
    </div>
    <button class="btn btn-primary" onclick="randomPick()">ğŸ² éšæœºå¸®æˆ‘é€‰ä¸€ä¸ªï¼</button>
    <button class="btn btn-secondary" onclick="restartAll()">ğŸ”„ é‡æ–°å¼€å§‹</button>
    <button class="btn btn-secondary" onclick="closeGiveup()">ğŸ‘€ ç»§ç»­çœ‹å½“å‰ç»“æœ</button>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  å…¨å±€çŠ¶æ€
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let apiKey  = localStorage.getItem("amap_api_key");
let prefs   = JSON.parse(localStorage.getItem("prefs")||'{"province":"","dislikes":[],"spicy":"å¾®è¾£","diet":"æ­£å¸¸é¥®é£Ÿ"}');
let loc     = null;   // {lat, lng}
let manualCity = "";
let curMode = "couple";
let curKeyword = "é¤å…";
let searchCount = 0;
let recipeCount = 0;
let allPois    = [];
let allRecipes = [];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  åˆå§‹åŒ–
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.onload = () => {
  if (!apiKey) {
    apiKey = prompt("ğŸ”‘ è¯·è¾“å…¥é«˜å¾·åœ°å›¾ Web æœåŠ¡ API Key\n\nè¿˜æ²¡æœ‰ï¼Ÿè®¿é—® https://lbs.amap.com/ å…è´¹è·å–");
    if (apiKey) localStorage.setItem("amap_api_key", apiKey);
  }
  buildPrefUI();
  getLocation();
  if (prefs.province) {
    document.getElementById("prefProvince").value = prefs.province;
    updateProvinceLabel();
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  å®šä½
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getLocation() {
  setLoc("spin","å®šä½ä¸­...");
  if (!navigator.geolocation) { setLoc("fail","æµè§ˆå™¨ä¸æ”¯æŒå®šä½"); return; }
  navigator.geolocation.getCurrentPosition(
    pos => { loc={lat:pos.coords.latitude,lng:pos.coords.longitude}; setLoc("ok","å®šä½æˆåŠŸ Â·ç‚¹å‡»åˆ·æ–°"); },
    ()  => { loc=null; setLoc("fail","å®šä½å¤±è´¥ Â· ç‚¹å‡»é‡è¯•"); },
    {timeout:8000}
  );
}
function setLoc(status,text){
  document.getElementById("locDot").className = "loc-dot " + (status==="ok"?"ok":status==="spin"?"spin":"fail");
  document.getElementById("locText").textContent = text;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  API Key é‡ç½®
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function resetApiKey(){
  if(confirm("ç¡®å®šæ¸…é™¤ API Keyï¼Ÿ")){
    localStorage.removeItem("amap_api_key");
    location.reload();
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  æ¨¡å¼åˆ‡æ¢
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchMode(mode,btn){
  curMode = mode;
  document.querySelectorAll(".mode-tab").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  é¡µé¢å¯¼èˆª
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showTakeout(){
  document.getElementById("homeSection").style.display="none";
  document.getElementById("takeoutSection").style.display="block";
  document.getElementById("cookingSection").style.display="none";
  if (!loc) document.getElementById("citySection").style.display="block";
  searchCount=0;
  document.getElementById("searchCounter").textContent="";
}
function showCooking(){
  document.getElementById("homeSection").style.display="none";
  document.getElementById("takeoutSection").style.display="none";
  document.getElementById("cookingSection").style.display="block";
  recipeCount=0;
  document.getElementById("recipeCounter").textContent="";
}
function backHome(){
  document.getElementById("homeSection").style.display="block";
  document.getElementById("takeoutSection").style.display="none";
  document.getElementById("cookingSection").style.display="none";
  document.getElementById("takeoutResult").innerHTML="";
  document.getElementById("recipeResult").innerHTML="";
  searchCount=0; recipeCount=0;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  åŸå¸‚é€‰æ‹©ï¼ˆå®šä½å¤±è´¥æ—¶ï¼‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function pickCity(city,btn){
  manualCity = city;
  document.querySelectorAll(".city-btn").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
  document.getElementById("citySection").style.display="none";
  searchFood();
}
function useCustomCity(){
  const v = document.getElementById("customCity").value.trim();
  if(!v){alert("è¯·è¾“å…¥åŸå¸‚åç§°");return;}
  manualCity = v;
  document.getElementById("citySection").style.display="none";
  searchFood();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  èœç³»æ ‡ç­¾
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function pickCuisine(el,kw){
  document.querySelectorAll(".ctag").forEach(t=>t.classList.remove("active"));
  el.classList.add("active");
  curKeyword = kw;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  æœç´¢å¤–å–ï¼ˆä½ çš„æ ¸å¿ƒé€»è¾‘ + å‡çº§ç‰ˆï¼‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CUISINE_MAP = [
  {key:"ğŸ² ç«é”…/ä¸²ä¸²",  tags:["ç«é”…","ä¸²ä¸²","å†’èœ","éº»è¾£çƒ«"]},
  {key:"ğŸ– çƒ§çƒ¤/å¤œå®µ",  tags:["çƒ§çƒ¤","çƒ¤è‚‰","å¤œå®µ","æ’¸ä¸²"]},
  {key:"ğŸ£ æ—¥æ–™",       tags:["å¯¿å¸","æ—¥å¼","æ—¥æ–™","æ‹‰é¢","å±…é…’å±‹"]},
  {key:"ğŸ‡°ğŸ‡· éŸ©é¤",      tags:["éŸ©","ç‚¸é¸¡","çŸ³é”…","æ³¡èœ"]},
  {key:"ğŸœ ç²¥ç²‰é¢",     tags:["ç²¥","ç²‰","é¢","ç±³çº¿","èºè›³","æ²³ç²‰"]},
  {key:"ğŸ¥— è½»é£Ÿ/æ²™æ‹‰",  tags:["æ²™æ‹‰","è½»é£Ÿ","ç´ é£Ÿ","å¥åº·"]},
  {key:"ğŸ” å¿«é¤",       tags:["å¿«é¤","ç›–é¥­","å¥—é¤","è‡ªåŠ©","ä¾¿å½“"]},
  {key:"ğŸ— çƒ§è…Š/ç…²ä»”",  tags:["çƒ§è…Š","çƒ§é¸­","å‰çƒ§","ç…²ä»”","çƒ§å‘³"]},
  {key:"ğŸ› å…¶ä»–ç¾é£Ÿ",   tags:[]},
];

function classifyCuisine(poi){
  const t = (poi.name+" "+poi.type).toLowerCase();
  for(const c of CUISINE_MAP){
    if(c.tags.some(tag=>t.includes(tag))) return c.key;
  }
  return "ğŸ› å…¶ä»–ç¾é£Ÿ";
}

async function searchFood(){
  searchCount++;
  if(searchCount>=4){
    document.getElementById("giveupCount").textContent=searchCount;
    openGiveup(); return;
  }
  document.getElementById("searchCounter").textContent=`å·²æ¢ ${searchCount} æ¬¡`;
  document.getElementById("takeoutResult").innerHTML='<div class="loading">ğŸ” æ­£åœ¨æœç´¢é™„è¿‘ç¾é£Ÿ...</div>';

  try{
    let url;
    if(loc){
      // å®šä½æˆåŠŸï¼šå‘¨è¾¹æœç´¢ï¼ˆè·ç¦»æ’åºï¼‰
      url=`https://restapi.amap.com/v3/place/around?key=${apiKey}&location=${loc.lng},${loc.lat}&keywords=${encodeURIComponent(curKeyword)}&types=050000|060000&radius=3000&sortrule=distance&offset=25&extensions=all`;
    } else {
      // æ— å®šä½ï¼šåŸå¸‚æ–‡æœ¬æœç´¢
      url=`https://restapi.amap.com/v3/place/text?key=${apiKey}&keywords=${encodeURIComponent(curKeyword)}&city=${encodeURIComponent(manualCity)}&types=050000|060000&offset=25&extensions=all`;
    }
    const data = await fetch(url).then(r=>r.json());
    if(data.status==="1"&&data.pois?.length){
      allPois = data.pois;
      renderPois(groupPois(filterPois(allPois)));
    } else {
      document.getElementById("takeoutResult").innerHTML='<div class="empty">ğŸ˜• æ²¡æ‰¾åˆ°é¤å…ï¼Œæ¢ä¸ªå…³é”®è¯è¯•è¯•</div>';
    }
  } catch(e){
    document.getElementById("takeoutResult").innerHTML=`<div class="empty">âŒ æœç´¢å¤±è´¥<br>${e.message}</div>`;
  }
}

function filterPois(pois){
  return pois.filter(p=>!prefs.dislikes.some(d=>p.name.toLowerCase().includes(d)));
}

function groupPois(pois){
  const groups={};
  pois.forEach(p=>{
    const c=classifyCuisine(p);
    if(!groups[c])groups[c]=[];
    groups[c].push(p);
  });
  return groups;
}

function renderPois(groups){
  let html="";
  for(const c in groups){
    html+=`<div class="poi-group">
      <div class="poi-group-title">${c}<span class="poi-count">${groups[c].length}å®¶</span></div>`;
    groups[c].slice(0,5).forEach(p=>{
      const matchTag = getPoiMatch(p);
      html+=`<div class="poi-item">
        <div class="poi-name">${p.name}</div>
        <div class="poi-addr">ğŸ“ ${p.address||p.pname+p.cityname}</div>
        ${matchTag?`<span class="badge b-match" style="display:inline-block;margin-bottom:8px;">${matchTag}</span>`:""}
        <div class="poi-actions">
          <a href="https://waimai.meituan.com/search/${encodeURIComponent(p.name)}" target="_blank" class="a-mt">ğŸ›µ ç¾å›¢å¤–å–</a>
          <a href="https://www.ele.me/search/${encodeURIComponent(p.name)}" target="_blank" class="a-el">ğŸ¥¡ é¥¿äº†ä¹ˆ</a>
        </div>
      </div>`;
    });
    html+="</div>";
  }
  document.getElementById("takeoutResult").innerHTML = html||'<div class="empty">æ²¡æœ‰åŒ¹é…ç»“æœ</div>';
}

function getPoiMatch(poi){
  const tags=[];
  if(curMode==="couple") tags.push("ğŸ’‘ é€‚åˆä¸¤äºº");
  if(prefs.spicy==="ä¸åƒè¾£"&&!/è¾£|å·/.test(poi.name)) tags.push("âœ… ä¸è¾£");
  if(prefs.diet==="å‡è„‚ä¸­"&&/æ²™æ‹‰|è½»é£Ÿ|è’¸/.test(poi.name)) tags.push("ğŸ¯ ç¬¦åˆå‡è„‚");
  return tags.join(" Â· ");
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  åœ¨å®¶åš â€”â€” èœè°±æ¨è
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showRecipes(){
  recipeCount++;
  if(recipeCount>=4){
    document.getElementById("giveupCount").textContent=recipeCount;
    openGiveup(); return;
  }
  document.getElementById("recipeCounter").textContent=`å·²æ¢ ${recipeCount} æ¬¡`;
  allRecipes = getRecipes();
  renderRecipes(sortRecipes(allRecipes).slice(0,10));
}

function renderRecipes(list){
  if(!list.length){
    document.getElementById("recipeResult").innerHTML='<div class="empty">æš‚æ— èœè°±ï¼Œè¯·åœ¨âš™ï¸åå¥½ä¸­é€‰æ‹©å®¶ä¹¡</div>';
    return;
  }
  let html="";
  list.forEach((r,i)=>{
    const m=getRecipeMatch(r);
    html+=`<div class="recipe-item">
      <div class="recipe-name">${r.name}</div>
      <div class="recipe-badges">
        <span class="badge b-time">â± ${r.time}åˆ†é’Ÿ</span>
        <span class="badge b-diff">ğŸ‘¨â€ğŸ³ ${r.difficulty}</span>
        ${r.spicy>0?`<span class="badge b-spicy">${"ğŸŒ¶".repeat(r.spicy)}</span>`:""}
        ${m?`<span class="badge b-match">${m}</span>`:""}
      </div>
      <button class="recipe-toggle" onclick="toggleDetail(${i},this)">ğŸ“– æŸ¥çœ‹è¯¦ç»†é£Ÿè°± â–¼</button>
      <div class="recipe-detail" id="rd${i}">
        <div class="recipe-section">
          <h4>ğŸ¥˜ é£Ÿæ</h4>
          <ul>${r.ingredients.map(x=>`<li>${x}</li>`).join("")}</ul>
        </div>
        <div class="recipe-section">
          <h4>ğŸ‘¨â€ğŸ³ åšæ³•</h4>
          <ul>${r.steps.map((s,n)=>`<li><b>${n+1}.</b> ${s}</li>`).join("")}</ul>
        </div>
        ${r.tips?`<div class="recipe-tip">ğŸ’¡ ${r.tips}</div>`:""}
      </div>
    </div>`;
  });
  document.getElementById("recipeResult").innerHTML=html;
}

function toggleDetail(i,btn){
  const d=document.getElementById("rd"+i);
  d.classList.toggle("open");
  btn.textContent=d.classList.contains("open")?"ğŸ“– æ”¶èµ·é£Ÿè°± â–²":"ğŸ“– æŸ¥çœ‹è¯¦ç»†é£Ÿè°± â–¼";
}

function sortRecipes(list){
  return [...list].sort((a,b)=>{
    let sa=0,sb=0;
    if(prefs.spicy==="ä¸åƒè¾£"){sa-=a.spicy*3;sb-=b.spicy*3;}
    if(prefs.diet==="å‡è„‚ä¸­"){
      if(/è’¸|æ‹Œ|ç…®/.test(a.name))sa+=4;
      if(/è’¸|æ‹Œ|ç…®/.test(b.name))sb+=4;
      if(/ç‚¸|çº¢çƒ§|å›é”…/.test(a.name))sa-=2;
      if(/ç‚¸|çº¢çƒ§|å›é”…/.test(b.name))sb-=2;
    }
    prefs.dislikes.forEach(d=>{
      if(a.ingredients.some(x=>x.includes(d)))sa-=10;
      if(b.ingredients.some(x=>x.includes(d)))sb-=10;
    });
    return sb-sa;
  });
}

function getRecipeMatch(r){
  const t=[];
  if(curMode==="couple"&&r.difficulty==="ç®€å•")t.push("ğŸ’‘ é€‚åˆä¸€èµ·åš");
  if(prefs.spicy==="ä¸åƒè¾£"&&r.spicy===0)t.push("âœ… ä¸è¾£");
  if(prefs.diet==="å‡è„‚ä¸­"&&/è’¸|æ‹Œ|ç…®/.test(r.name))t.push("ğŸ¯ ç¬¦åˆå‡è„‚");
  if(prefs.province&&r.province===prefs.province)t.push("ğŸ  å®¶ä¹¡å‘³");
  return t.join(" Â· ");
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  é€‰æ‹©å›°éš¾å¼¹çª—
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openGiveup(){document.getElementById("giveupModal").classList.add("show");}
function closeGiveup(){document.getElementById("giveupModal").classList.remove("show");}
function restartAll(){closeGiveup();searchCount=0;recipeCount=0;backHome();}
function randomPick(){
  closeGiveup();
  searchCount=0;recipeCount=0;
  if(document.getElementById("cookingSection").style.display!=="none"){
    const r=allRecipes[Math.floor(Math.random()*allRecipes.length)];
    renderRecipes([r]);
    document.getElementById("recipeCounter").textContent="ğŸ² å·²éšæœºå¸®ä½ é€‰äº†ä¸€é“ï¼";
  } else {
    const p=allPois[Math.floor(Math.random()*allPois.length)];
    if(p)renderPois({"ğŸ² éšæœºæ¨è":[p]});
    document.getElementById("searchCounter").textContent="ğŸ² å·²éšæœºå¸®ä½ é€‰äº†ä¸€å®¶ï¼";
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  åå¥½è®¾ç½®
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openSettings(){document.getElementById("settingsModal").classList.add("show");}
function closeSettings(){document.getElementById("settingsModal").classList.remove("show");}

function buildPrefUI(){
  mkBtns("prefDislikes",["é¦™èœ","å†…è„","æµ·é²œ","è¾£æ¤’","æ´‹è‘±","èŠ¹èœ","èŒ„å­","è‹¦ç“œ"],prefs.dislikes,true);
  mkBtns("prefSpicy",["ä¸åƒè¾£","å¾®è¾£","ä¸­è¾£","ç‰¹è¾£"],[prefs.spicy],false);
  mkBtns("prefDiet",["æ­£å¸¸é¥®é£Ÿ","å‡è„‚ä¸­","å¥èº«å¢è‚Œ","ä½ç¢³é¥®é£Ÿ"],[prefs.diet],false);
  if(prefs.province)document.getElementById("prefProvince").value=prefs.province;
}

function mkBtns(id,opts,selected,multi){
  const box=document.getElementById(id);
  box.innerHTML="";
  opts.forEach(o=>{
    const b=document.createElement("button");
    b.className="pref-btn"+(selected.includes(o)?" selected":"");
    b.textContent=o;
    b.onclick=()=>{
      if(multi)b.classList.toggle("selected");
      else{box.querySelectorAll(".pref-btn").forEach(x=>x.classList.remove("selected"));b.classList.add("selected");}
    };
    box.appendChild(b);
  });
}

function quickSaveProvince(){
  prefs.province=document.getElementById("prefProvince").value;
  localStorage.setItem("prefs",JSON.stringify(prefs));
  updateProvinceLabel();
}

function updateProvinceLabel(){
  const label=prefs.province?prefs.province+"èœ":"å®¶å¸¸èœ";
  document.getElementById("provinceLabel").textContent=label;
}

function saveSettings(){
  prefs.dislikes=[...document.querySelectorAll("#prefDislikes .selected")].map(b=>b.textContent);
  prefs.spicy=document.querySelector("#prefSpicy .selected")?.textContent||"å¾®è¾£";
  prefs.diet=document.querySelector("#prefDiet .selected")?.textContent||"æ­£å¸¸é¥®é£Ÿ";
  prefs.province=document.getElementById("prefProvince").value;
  localStorage.setItem("prefs",JSON.stringify(prefs));
  updateProvinceLabel();
  closeSettings();
  alert("âœ… åå¥½å·²ä¿å­˜ï¼ä¸‹æ¬¡æ¨èæ›´ç²¾å‡†~");
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  èœè°±æ•°æ®åº“
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getRecipes(){
  const p=prefs.province||"é€šç”¨";
  const DB={
    "å·æ¸":[
      {name:"é±¼é¦™è‚‰ä¸",time:25,difficulty:"ç®€å•",spicy:2,province:"å·æ¸",
       ingredients:["é‡Œè„Šè‚‰ 200g","æœ¨è€³ 50g","èƒ¡èåœ 1æ ¹","é’æ¤’ 1ä¸ª","è‘±å§œè’œ é€‚é‡","è±†ç“£é…± 1å‹º"],
       steps:["è‚‰åˆ‡ä¸åŠ æ–™é…’ç›æ·€ç²‰è…Œ10åˆ†é’Ÿ","æœ¨è€³æ³¡å‘åˆ‡ä¸ï¼Œèƒ¡èåœé’æ¤’åˆ‡ä¸","è°ƒé±¼é¦™æ±ï¼šç³–2å‹ºé†‹1å‹ºé…±æ²¹1å‹ºæ·€ç²‰","çƒ­æ²¹æ»‘ç‚’è‚‰ä¸å˜è‰²ç››å‡º","ç‚’é¦™è‘±å§œè’œåŠ è±†ç“£é…±å‡ºçº¢æ²¹","ä¸‹é…èœç¿»ç‚’ï¼Œå›é”…è‚‰ä¸ï¼Œæ·‹é±¼é¦™æ±å¤§ç«æ”¶æ±"],
       tips:"ç³–é†‹2:1æ˜¯å…³é”®ï¼Œè±†ç“£é…±è¦ç‚’å‡ºçº¢æ²¹æ‰é¦™"},
      {name:"éº»å©†è±†è…",time:20,difficulty:"ç®€å•",spicy:3,province:"å·æ¸",
       ingredients:["å«©è±†è… 1ç›’","ç‰›è‚‰æœ« 100g","è±†ç“£é…± 2å‹º","èŠ±æ¤’ç²‰ 1å‹º","è‘±å§œè’œ"],
       steps:["è±†è…åˆ‡å—ç„¯æ°´","ç‚’ç‰›è‚‰æœ«å˜è‰²","åŠ è±†ç“£é…±ç‚’çº¢æ²¹","åŠ æ°´çƒ§å¼€æ”¾è±†è…ç…®5åˆ†é’Ÿ","æ°´æ·€ç²‰å‹¾èŠ¡ï¼Œæ’’èŠ±æ¤’ç²‰è‘±èŠ±"],
       tips:"è±†è…å…ˆç„¯æ°´æ›´å«©ï¼ŒèŠ±æ¤’ç²‰æœ€åæ’’æ‰é¦™"},
      {name:"å®«ä¿é¸¡ä¸",time:20,difficulty:"ä¸­ç­‰",spicy:2,province:"å·æ¸",
       ingredients:["é¸¡èƒ¸è‚‰ 250g","èŠ±ç”Ÿç±³ 80g","å¹²è¾£æ¤’ 10ä¸ª","èŠ±æ¤’ 1å‹º","è‘±å§œè’œ"],
       steps:["é¸¡è‚‰åˆ‡ä¸è…Œåˆ¶","èŠ±ç”Ÿç‚¸é…¥å¤‡ç”¨","è°ƒå®«ä¿æ±ï¼šç³–2é†‹1é…±æ²¹1","æ»‘ç‚’é¸¡ä¸ç››å‡º","çˆ†é¦™å¹²è¾£æ¤’èŠ±æ¤’","å›é”…é¸¡ä¸æ·‹å®«ä¿æ±åŠ èŠ±ç”Ÿå¿«ç‚’"],
       tips:"èŠ±ç”Ÿæœ€åæ”¾æ‰è„†"},
      {name:"å›é”…è‚‰",time:35,difficulty:"ä¸­ç­‰",spicy:2,province:"å·æ¸",
       ingredients:["äº”èŠ±è‚‰ 300g","é’è’œ 3æ ¹","è±†ç“£é…± 2å‹º","è±†è±‰ 1å‹º","é’çº¢æ¤’å„1ä¸ª"],
       steps:["äº”èŠ±è‚‰ç…®è‡³8æˆç†Ÿåˆ‡è–„ç‰‡","ä¸æ”¾æ²¹ç…¸å‡ºçŒªæ²¹","åŠ è±†ç“£é…±è±†è±‰ç‚’çº¢æ²¹","ä¸‹é’æ¤’è’œç™½ç¿»ç‚’","å›é”…è‚‰ç¿»åŒ€åŠ è’œå¶"],
       tips:"è±†ç“£é…±ç‚’å‡ºçº¢æ²¹æ˜¯å…³é”®"},
      {name:"æ°´ç…®è‚‰ç‰‡",time:25,difficulty:"ä¸­ç­‰",spicy:3,province:"å·æ¸",
       ingredients:["é‡Œè„Šè‚‰ 250g","ç™½èœ 200g","è±†èŠ½ 100g","å¹²è¾£æ¤’ 15ä¸ª","èŠ±æ¤’ 2å‹º","è±†ç“£é…± 2å‹º"],
       steps:["è‚‰ç‰‡åŠ è›‹æ¸…æ·€ç²‰è…Œåˆ¶","ç™½èœè±†èŠ½ç„¯æ°´é“ºåº•","ç‚’è±†ç“£é…±åŠ æ°´çƒ§å¼€","è‚‰ç‰‡ä¸‹é”…ç…®ç†Ÿç››å‡º","é“ºå¹²è¾£æ¤’èŠ±æ¤’æµ‡çƒ­æ²¹"],
       tips:"æœ€åæµ‡çƒ­æ²¹æ˜¯çµé­‚"},
    ],
    "å¹¿ä¸œ":[
      {name:"ç™½åˆ‡é¸¡",time:40,difficulty:"ç®€å•",spicy:0,province:"å¹¿ä¸œ",
       ingredients:["ä¸‰é»„é¸¡ 1åª","å§œ 50g","è‘± 2æ ¹","æ–™é…’","è’¸é±¼è±‰æ²¹"],
       steps:["é¸¡è‚šå¡å§œè‘±","å¼€æ°´åŠ å§œè‘±æ–™é…’ä¸‹é¸¡","çƒ§å¼€å°ç«15åˆ†é’Ÿ","ç„–15åˆ†é’Ÿæå‡ºè¿‡å†°æ°´","åˆ‡å—è˜¸æ–™ä¸Šæ¡Œ"],
       tips:"å†°æ°´è®©é¸¡çš®çˆ½æ»‘Qå¼¹"},
      {name:"è’œè“‰è’¸è™¾",time:15,difficulty:"ç®€å•",spicy:0,province:"å¹¿ä¸œ",
       ingredients:["åŸºå›´è™¾ 500g","è’œ 1å¤´","ç²‰ä¸ 1æŠŠ","è’¸é±¼è±‰æ²¹ 2å‹º","å°ç±³æ¤’ 2ä¸ª"],
       steps:["è™¾å‰ªé¡»å¼€èƒŒ","ç²‰ä¸æ³¡è½¯é“ºåº•","é‡‘é“¶è’œé“ºè™¾ä¸Š","å¤§ç«è’¸5åˆ†é’Ÿ","æ·‹è±‰æ²¹æ’’è‘±èŠ±å°ç±³æ¤’"],
       tips:"ä¸è¦è’¸å¤ªä¹…ï¼Œè™¾è‚‰ä¼šè€"},
      {name:"å¹²ç‚’ç‰›æ²³",time:15,difficulty:"ä¸­ç­‰",spicy:0,province:"å¹¿ä¸œ",
       ingredients:["æ²³ç²‰ 400g","ç‰›è‚‰ 150g","è±†èŠ½ 100g","éŸ­é»„ 50g","ç”ŸæŠ½è€æŠ½"],
       steps:["ç‰›è‚‰åŠ å°è‹æ‰“ç”ŸæŠ½æ²¹è…Œåˆ¶","æ²³ç²‰æ’•æ•£å¤‡ç”¨","å¤§ç«æ»‘ç‚’ç‰›è‚‰7æˆç››å‡º","ä¸‹æ²³ç²‰ç¿»ç‚’ä¸Šè‰²","åŠ è±†èŠ½éŸ­é»„ï¼Œå›é”…ç‰›è‚‰å¤§ç«ç‚’åŒ€"],
       tips:"å…¨ç¨‹å¤§ç«ï¼Œå°è‹æ‰“è®©ç‰›è‚‰å«©"},
      {name:"æ¸…è’¸é²ˆé±¼",time:20,difficulty:"ç®€å•",spicy:0,province:"å¹¿ä¸œ",
       ingredients:["é²ˆé±¼ 1æ¡","å§œ 30g","è‘± 2æ ¹","è’¸é±¼è±‰æ²¹ 3å‹º","æ–™é…’"],
       steps:["é±¼åˆ’åˆ€æŠ¹æ–™é…’ç›è…Œ10åˆ†é’Ÿ","å§œè‘±é“ºé±¼èº«","æ°´å¼€å¤§ç«è’¸8åˆ†é’Ÿ","å€’æ‰è’¸æ°´é‡é“ºå§œè‘±","æ·‹è±‰æ²¹æµ‡çƒ­æ²¹"],
       tips:"è’¸å‡ºçš„æ°´è¦å€’æ‰å»è…¥"},
    ],
    "å¹¿è¥¿":[
      {name:"æŸ æª¬é¸­",time:50,difficulty:"ä¸­ç­‰",spicy:1,province:"å¹¿è¥¿",
       ingredients:["é¸­è‚‰ 500g","é…¸æŸ æª¬ 3ä¸ª","é…¸å§œ 50g","ç´«è‹ 20g","ç”ŸæŠ½ 2å‹º","è’œ"],
       steps:["é¸­è‚‰æ–©å—ç„¯æ°´","çƒ­æ²¹çˆ†é¦™è’œå§œ","ä¸‹é¸­è‚‰ç¿»ç‚’é‡‘é»„","åŠ é…¸æŸ æª¬ç‰‡é…¸å§œ","åŠ æ°´æ²¡è¿‡ç„–30åˆ†é’Ÿ","æ”¶æ±åŠ ç´«è‹ç¿»ç‚’"],
       tips:"é…¸æŸ æª¬æ˜¯å¹¿è¥¿æŸ æª¬é¸­çš„çµé­‚ï¼Œç´«è‹å¿…ä¸å¯å°‘"},
      {name:"èºè›³ç²‰ï¼ˆå®¶åº­ç‰ˆï¼‰",time:30,difficulty:"ç®€å•",spicy:2,province:"å¹¿è¥¿",
       ingredients:["èºè›³ç²‰æ–™åŒ… 1å¥—","è…ç«¹","é…¸ç¬‹","èŠ±ç”Ÿ","æœ¨è€³","è‘±èŠ±"],
       steps:["æŒ‰åŒ…è£…ç…®æ±¤åº•","è…ç«¹èŠ±ç”Ÿç‚¸è‡³é‡‘é»„","é…¸ç¬‹æœ¨è€³ç„¯æ°´","ç²‰ç…®è½¯æå‡º","åŠ æ±¤åº•å’Œé…èœæ’’è‘±èŠ±è¾£æ¤’æ²¹"],
       tips:"æ±¤åº•è¦æµ“æ‰å¤Ÿå‘³"},
      {name:"ç™½æ–©é¸¡é…ç´«è‹è˜¸æ–™",time:35,difficulty:"ç®€å•",spicy:0,province:"å¹¿è¥¿",
       ingredients:["åœŸé¸¡ åŠåª","ç´«è‹ 50g","è’œ 5ç“£","å°ç±³æ¤’ 3ä¸ª","ç”ŸæŠ½","æŸ æª¬æ±"],
       steps:["åœŸé¸¡å†·æ°´ä¸‹é”…ç…®ç†Ÿ","è¿‡å†°æ°´åˆ‡å—","ç´«è‹è’œå°ç±³æ¤’å‰ç¢","åŠ ç”ŸæŠ½æŸ æª¬æ±è°ƒè˜¸æ–™","é¸¡è‚‰è˜¸æ–™é£Ÿç”¨"],
       tips:"å¹¿è¥¿ç™½æ–©é¸¡çš„çµé­‚æ˜¯ç´«è‹è˜¸æ–™"},
      {name:"çƒ¤çŒªè¹„",time:90,difficulty:"ä¸­ç­‰",spicy:1,province:"å¹¿è¥¿",
       ingredients:["çŒªè¹„ 1åª","å—ä¹³ 2å—","è’œ 1å¤´","äº”é¦™ç²‰","èœ‚èœœ 2å‹º"],
       steps:["çŒªè¹„ç„¯æ°´æ´—å‡€","å—ä¹³è’œäº”é¦™ç²‰æ¶‚æŠ¹è…Œ2å°æ—¶","çƒ¤ç®±200åº¦çƒ¤30åˆ†é’Ÿ","åˆ·èœ‚èœœå†çƒ¤20åˆ†é’Ÿ","åˆ‡å—é£Ÿç”¨"],
       tips:"å¤šåˆ·å‡ æ¬¡èœ‚èœœé¢œè‰²æ›´æ¼‚äº®ï¼Œå¤–çš®æ›´è„†"},
      {name:"ç”°èºç„–é¸­",time:60,difficulty:"ä¸­ç­‰",spicy:1,province:"å¹¿è¥¿",
       ingredients:["ç”°èº 500g","é¸­è‚‰ 300g","ç´«è‹ 30g","è’œ 1å¤´","è±†è±‰ 1å‹º","å°ç±³æ¤’"],
       steps:["ç”°èºæå‰åæ²™æ´—å‡€","é¸­è‚‰æ–©å—ç„¯æ°´","çƒ­æ²¹çˆ†é¦™è’œè±†è±‰å°ç±³æ¤’","ä¸‹é¸­è‚‰ç¿»ç‚’","åŠ ç”°èºç¿»ç‚’","åŠ æ°´ç„–ç…®25åˆ†é’Ÿ","åŠ ç´«è‹æ”¶æ±"],
       tips:"ç´«è‹æ˜¯å¹¿è¥¿ç„–ç”°èºå¿…å¤‡ï¼Œç”°èºè¦å……åˆ†åæ²™"},
    ],
    "æ±Ÿæµ™æ²ª":[
      {name:"çº¢çƒ§è‚‰",time:60,difficulty:"ä¸­ç­‰",spicy:0,province:"æ±Ÿæµ™æ²ª",
       ingredients:["äº”èŠ±è‚‰ 500g","å†°ç³– 30g","å…«è§’ 2ä¸ª","æ¡‚çš®","ç”ŸæŠ½ 3å‹º","è€æŠ½ 1å‹º"],
       steps:["äº”èŠ±è‚‰åˆ‡å—ç„¯æ°´","ç‚’å†°ç³–è‡³ç„¦ç³–è‰²","ä¸‹è‚‰å—ä¸Šè‰²","åŠ è°ƒæ–™å’Œå¼€æ°´å°ç«ç‚–40åˆ†é’Ÿ","å¤§ç«æ”¶æ±"],
       tips:"ç‚–åˆ°ç­·å­èƒ½è½»æ¾æ’å…¥å³å¯"},
      {name:"ç³–é†‹å°æ’",time:40,difficulty:"ä¸­ç­‰",spicy:0,province:"æ±Ÿæµ™æ²ª",
       ingredients:["å°æ’ 500g","ç³– 4å‹º","é†‹ 3å‹º","ç”ŸæŠ½ 2å‹º","æ–™é…’"],
       steps:["å°æ’ç„¯æ°´","ä¸¤é¢ç…è‡³é‡‘é»„","åŠ æ°´ç‚–20åˆ†é’Ÿ","å€’ç³–é†‹æ±å¤§ç«æ”¶æ±è‡³æµ“ç¨ "],
       tips:"ç³–é†‹æ¯”4:3:2æœ€ç»å…¸"},
    ],
    "æ¹–å—":[
      {name:"å‰æ¤’é±¼å¤´",time:30,difficulty:"ä¸­ç­‰",spicy:3,province:"æ¹–å—",
       ingredients:["é±¼å¤´ 1ä¸ª","å‰æ¤’ 100g","å§œ","è‘±","è’¸é±¼è±‰æ²¹"],
       steps:["é±¼å¤´è…Œåˆ¶","å§œé“ºåº•ï¼Œé±¼å¤´æ‘†ä¸Š","é“ºæ»¡å‰æ¤’æ·‹æ²¹","å¤§ç«è’¸10åˆ†é’Ÿ","æ·‹è±‰æ²¹æµ‡çƒ­æ²¹"],
       tips:"å‰æ¤’ä¸è¦ä¹°å¤ªå’¸çš„"},
      {name:"å°ç‚’é»„ç‰›è‚‰",time:20,difficulty:"ç®€å•",spicy:2,province:"æ¹–å—",
       ingredients:["ç‰›è‚‰ 250g","é’æ¤’ 2ä¸ª","å°ç±³æ¤’ 5ä¸ª","å§œè’œ"],
       steps:["ç‰›è‚‰é€†çº¹åˆ‡ç‰‡è…Œåˆ¶","å¤§ç«æ»‘ç‚’å˜è‰²ç››å‡º","çˆ†é¦™å§œè’œå°ç±³æ¤’","ä¸‹é’æ¤’ç¿»ç‚’","å›é”…ç‰›è‚‰è°ƒå‘³"],
       tips:"é€†çº¹åˆ‡+å¤§ç«æ˜¯å«©æ»‘å…³é”®"},
    ],
    "é€šç”¨":[
      {name:"ç•ªèŒ„ç‚’è›‹",time:10,difficulty:"ç®€å•",spicy:0,province:"é€šç”¨",
       ingredients:["é¸¡è›‹ 3ä¸ª","ç•ªèŒ„ 2ä¸ª","ç³– 1å‹º","ç› é€‚é‡"],
       steps:["è›‹æ‰“æ•£åŠ ç›","ç•ªèŒ„åˆ‡å—","ç‚’è›‹åŠç†Ÿç››å‡º","ç‚’ç•ªèŒ„å‡ºæ±åŠ ç³–","å›é”…è›‹ç¿»åŒ€"],
       tips:"åŠ ä¸€ç‚¹ç³–æé²œ"},
      {name:"é’æ¤’åœŸè±†ä¸",time:15,difficulty:"ç®€å•",spicy:1,province:"é€šç”¨",
       ingredients:["åœŸè±† 2ä¸ª","é’æ¤’ 1ä¸ª","è’œ 3ç“£","é†‹ 1å‹º","ç›"],
       steps:["åœŸè±†åˆ‡ä¸æ³¡æ°´","çˆ†é¦™è’œæœ«","ä¸‹åœŸè±†ä¸åŠ é†‹ç›","ä¸‹é’æ¤’ç‚’åŒ€"],
       tips:"æ³¡æ°´å»æ·€ç²‰æ‰è„†"},
      {name:"è’œè“‰è¥¿å…°èŠ±",time:10,difficulty:"ç®€å•",spicy:0,province:"é€šç”¨",
       ingredients:["è¥¿å…°èŠ± 1ä¸ª","è’œ 5ç“£","èšæ²¹ 1å‹º","ç›"],
       steps:["è¥¿å…°èŠ±ç„¯æ°´1åˆ†é’Ÿ","çˆ†é¦™è’œæœ«","ä¸‹è¥¿å…°èŠ±åŠ èšæ²¹ç›ç¿»ç‚’"],
       tips:"ç„¯æ°´åŠ ç›åŠ æ²¹é¢œè‰²æ›´ç»¿"},
      {name:"è›‹ç‚’é¥­",time:10,difficulty:"ç®€å•",spicy:0,province:"é€šç”¨",
       ingredients:["éš”å¤œç±³é¥­ 2ç¢—","é¸¡è›‹ 2ä¸ª","è‘± 1æ ¹","ç”ŸæŠ½ 1å‹º","ç›"],
       steps:["è›‹æ‰“æ•£","çƒ­æ²¹ç‚’è›‹ç¢ç››å‡º","ä¸‹ç±³é¥­ç¿»ç‚’æ•£å¼€","åŠ ç”ŸæŠ½ç›ç‚’åŒ€","å›é”…è›‹åŠ è‘±èŠ±ç¿»åŒ€"],
       tips:"éš”å¤œé¥­ç‚’å‡ºæ¥æ›´ç²’ç²’åˆ†æ˜"},
    ],
  };
  return DB[p]||DB["é€šç”¨"];
}
</script>
</body>
</html>
