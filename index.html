<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ğŸ’• ä»Šå¤©åƒä»€ä¹ˆ</title>
<meta name="theme-color" content="#ff6b81">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="ä»Šå¤©åƒä»€ä¹ˆ">
<link rel="manifest" href="manifest.json">
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap');
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',-apple-system,sans-serif;}
:root{--pink:#ff6b81;--pink-light:#fff0f3;--pink-mid:#ffd6dd;--green:#9EB5A3;--gray:#666;--shadow:0 4px 16px rgba(255,107,129,0.15);}
body{background:#fff7f9;min-height:100vh;}

header{background:linear-gradient(135deg,#ff6b81,#ff8fa3);color:white;padding:14px 18px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 12px rgba(255,107,129,0.3);position:sticky;top:0;z-index:100;}
.logo{font-size:18px;font-weight:600;}
.header-btns{display:flex;gap:6px;}
.header-btns button{background:rgba(255,255,255,0.2);color:white;border:1px solid rgba(255,255,255,0.4);padding:6px 10px;border-radius:20px;cursor:pointer;font-size:12px;transition:all 0.2s;}
.header-btns button:hover{background:rgba(255,255,255,0.35);}

#app{padding:16px;max-width:540px;margin:0 auto;}

.mode-tabs{display:flex;background:white;border-radius:14px;padding:4px;margin-bottom:14px;box-shadow:var(--shadow);}
.mode-tab{flex:1;padding:10px;border:none;background:transparent;border-radius:10px;cursor:pointer;font-size:14px;font-weight:500;color:var(--gray);transition:all 0.25s;}
.mode-tab.active{background:linear-gradient(135deg,#ff6b81,#ff8fa3);color:white;box-shadow:0 2px 8px rgba(255,107,129,0.35);}

.card{background:white;border-radius:16px;padding:18px;margin-bottom:14px;box-shadow:var(--shadow);}
.card-title{font-size:15px;font-weight:600;color:#333;margin-bottom:12px;}

.btn{width:100%;padding:13px;border:none;border-radius:12px;cursor:pointer;font-size:14px;font-weight:600;transition:all 0.25s;display:flex;align-items:center;justify-content:center;gap:6px;}
.btn-primary{background:linear-gradient(135deg,#ff6b81,#ff8fa3);color:white;box-shadow:0 4px 14px rgba(255,107,129,0.35);}
.btn-primary:hover{transform:translateY(-1px);}
.btn-secondary{background:white;color:var(--pink);border:2px solid var(--pink-mid);margin-top:8px;}
.btn-secondary:hover{background:var(--pink-light);}

/* å®šä½æ  */
.location-bar{display:flex;align-items:center;gap:8px;background:var(--pink-light);border-radius:10px;padding:10px 12px;margin-bottom:6px;font-size:13px;color:var(--gray);}
.loc-dot{width:8px;height:8px;border-radius:50%;background:#ccc;flex-shrink:0;transition:background 0.3s;}
.loc-dot.ok{background:#4caf50;}
.loc-dot.spin{background:#ff9800;animation:pulse 1s infinite;}
.loc-dot.fail{background:#f44336;}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}
.loc-btn{background:none;border:none;color:var(--pink);cursor:pointer;font-size:14px;padding:2px 6px;border-radius:6px;white-space:nowrap;}
.loc-btn:hover{background:var(--pink-mid);}
.manual-loc-row{display:flex;gap:8px;margin-bottom:14px;}
.manual-loc-row input{flex:1;padding:9px 12px;border:2px solid var(--pink-mid);border-radius:10px;font-size:13px;outline:none;}
.manual-loc-row input:focus{border-color:var(--pink);}
.manual-loc-row button{background:var(--pink);color:white;border:none;padding:9px 14px;border-radius:10px;cursor:pointer;font-size:13px;white-space:nowrap;}

/* é¦–é¡µå¡ç‰‡ */
.meal-card{background:white;border-radius:16px;padding:20px;margin-bottom:14px;box-shadow:var(--shadow);cursor:pointer;display:flex;align-items:center;gap:14px;transition:all 0.25s;}
.meal-card:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(255,107,129,0.2);}
.meal-icon{font-size:38px;flex-shrink:0;}
.meal-info{flex:1;}
.meal-title{font-size:16px;font-weight:600;color:#333;}
.meal-desc{font-size:12px;color:#999;margin-top:4px;line-height:1.5;}
.meal-arrow{color:#ddd;font-size:20px;}

/* èœç³»æ ‡ç­¾ */
.cuisine-filter{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:14px;}
.ctag{padding:6px 12px;border-radius:20px;border:2px solid var(--pink-mid);background:white;font-size:12px;cursor:pointer;transition:all 0.2s;color:var(--gray);}
.ctag.active{background:var(--pink);color:white;border-color:var(--pink);}

/* åŸå¸‚ç½‘æ ¼ */
.city-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:10px;}
.city-btn{padding:10px 6px;border:2px solid var(--pink-mid);background:white;border-radius:10px;cursor:pointer;font-size:13px;transition:all 0.2s;color:#333;}
.city-btn:hover,.city-btn.active{background:var(--pink);color:white;border-color:var(--pink);}

/* â•â•â•â• è½¬ç›˜ â•â•â•â• */
.wheel-wrap{display:flex;flex-direction:column;align-items:center;padding:10px 0 20px;}
.wheel-outer{position:relative;width:300px;height:300px;margin:0 auto;}
.wheel-canvas{border-radius:50%;box-shadow:0 4px 20px rgba(255,107,129,0.3);}
.wheel-pointer{position:absolute;top:-18px;left:50%;transform:translateX(-50%);font-size:32px;line-height:1;z-index:10;filter:drop-shadow(0 2px 4px rgba(0,0,0,0.2));}
.wheel-center-btn{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:60px;height:60px;border-radius:50%;background:white;border:none;cursor:pointer;font-size:22px;box-shadow:0 2px 10px rgba(0,0,0,0.15);z-index:10;transition:all 0.2s;}
.wheel-center-btn:hover{transform:translate(-50%,-50%) scale(1.1);}
.wheel-center-btn:active{transform:translate(-50%,-50%) scale(0.95);}
.wheel-result{margin-top:16px;text-align:center;}
.wheel-result-name{font-size:22px;font-weight:700;color:#333;}
.wheel-result-cat{font-size:13px;color:#999;margin:4px 0 12px;}
.wheel-result-desc{font-size:13px;color:var(--gray);background:var(--pink-light);border-radius:10px;padding:10px 14px;line-height:1.7;margin-bottom:14px;}

/* é¤å…å¡ç‰‡ */
.poi-group{margin-bottom:16px;}
.poi-group-title{font-size:14px;font-weight:600;color:#333;margin-bottom:10px;display:flex;align-items:center;gap:6px;}
.poi-count{background:var(--pink-light);color:var(--pink);font-size:11px;padding:2px 8px;border-radius:10px;}
.poi-item{background:white;border-radius:12px;padding:14px;margin-bottom:10px;box-shadow:0 2px 10px rgba(0,0,0,0.06);transition:all 0.2s;}
.poi-item:hover{transform:translateY(-1px);box-shadow:0 4px 14px rgba(0,0,0,0.1);}
.poi-name{font-size:15px;font-weight:600;color:#333;margin-bottom:6px;}
.poi-addr{font-size:12px;color:#999;margin-bottom:8px;line-height:1.5;}
.poi-actions{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
.poi-actions a{padding:9px;border-radius:8px;text-decoration:none;font-size:12px;font-weight:600;display:flex;align-items:center;justify-content:center;gap:4px;transition:all 0.2s;}
.a-mt{background:#FFD100;color:#333;}
.a-el{background:#0089FF;color:white;}

/* èœè°± */
.recipe-item{background:white;border-radius:12px;padding:16px;margin-bottom:12px;box-shadow:0 2px 10px rgba(0,0,0,0.06);}
.recipe-name{font-size:16px;font-weight:600;color:#333;margin-bottom:10px;}
.recipe-badges{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px;}
.badge{padding:3px 8px;border-radius:8px;font-size:11px;font-weight:500;}
.b-time{background:#fff3e0;color:#e65100;}
.b-diff{background:#e8f5e9;color:#2e7d32;}
.b-spicy{background:#fce4ec;color:#c62828;}
.b-match{background:var(--pink-light);color:var(--pink);}
.recipe-toggle{width:100%;padding:9px;border:2px solid var(--pink-mid);background:white;border-radius:8px;cursor:pointer;font-size:13px;color:var(--pink);font-weight:500;transition:all 0.2s;}
.recipe-toggle:hover{background:var(--pink-light);}
.recipe-detail{display:none;margin-top:12px;padding-top:12px;border-top:1px dashed var(--pink-mid);}
.recipe-detail.open{display:block;}
.recipe-section{margin-bottom:14px;}
.recipe-section h4{font-size:13px;color:#333;margin-bottom:8px;font-weight:600;}
.recipe-section li{font-size:13px;color:var(--gray);line-height:1.9;padding-left:14px;position:relative;list-style:none;}
.recipe-section li::before{content:"â€¢";position:absolute;left:0;color:var(--pink);}
.recipe-tip{background:#fff8e1;border-left:3px solid #ffc107;padding:10px 12px;border-radius:0 8px 8px 0;font-size:12px;color:#666;line-height:1.6;}

/* åå¥½è®¾ç½® */
.pref-section{margin-bottom:18px;}
.pref-section label{display:block;font-size:13px;font-weight:600;color:#333;margin-bottom:8px;}
.pref-section select{width:100%;padding:10px 12px;border:2px solid #ddd;border-radius:10px;font-size:14px;color:#333;background:white;}
.pref-options{display:flex;flex-wrap:wrap;gap:8px;}
.pref-btn{padding:7px 14px;border:2px solid #ddd;background:white;border-radius:10px;cursor:pointer;font-size:13px;transition:all 0.2s;color:#333;}
.pref-btn.selected{background:var(--pink);color:white;border-color:var(--pink);}

/* è‡ªå®šä¹‰èœå“ç®¡ç† */
.custom-dish-list{max-height:200px;overflow-y:auto;margin-bottom:12px;}
.custom-dish-item{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;background:#f9f9f9;border-radius:8px;margin-bottom:6px;font-size:13px;}
.del-dish-btn{background:none;border:none;color:#f44336;cursor:pointer;font-size:16px;padding:0 4px;}
.add-dish-row{display:flex;gap:8px;margin-top:8px;}
.add-dish-row input{flex:1;padding:8px 10px;border:2px solid #ddd;border-radius:8px;font-size:13px;}
.add-dish-row select{padding:8px;border:2px solid #ddd;border-radius:8px;font-size:13px;color:#333;}
.add-dish-row button{background:var(--pink);color:white;border:none;padding:8px 14px;border-radius:8px;cursor:pointer;font-size:13px;white-space:nowrap;}

/* å¼¹çª— */
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.45);z-index:999;align-items:flex-end;justify-content:center;}
.modal.show{display:flex;}
.modal-box{background:white;border-radius:24px 24px 0 0;padding:28px 20px 40px;width:100%;max-width:540px;max-height:88vh;overflow-y:auto;animation:slideUp 0.3s ease;}
@keyframes slideUp{from{transform:translateY(60px);opacity:0}to{transform:translateY(0);opacity:1}}
.modal-handle{width:40px;height:4px;background:#ddd;border-radius:2px;margin:0 auto 20px;}
.modal-title{font-size:18px;font-weight:600;color:#333;margin-bottom:20px;}

/* é€‰æ‹©å›°éš¾å¼¹çª— */
.giveup-modal{align-items:center;padding:20px;}
.giveup-box{background:white;border-radius:24px;padding:32px 24px;max-width:360px;width:100%;text-align:center;animation:popIn 0.3s cubic-bezier(.34,1.56,.64,1);}
@keyframes popIn{from{transform:scale(0.8);opacity:0}to{transform:scale(1);opacity:1}}
.giveup-emoji{font-size:64px;margin-bottom:16px;display:block;animation:wobble 0.6s ease;}
@keyframes wobble{0%,100%{transform:rotate(0)}25%{transform:rotate(-10deg)}75%{transform:rotate(10deg)}}
.giveup-title{font-size:20px;font-weight:600;color:#333;margin-bottom:10px;}
.giveup-text{font-size:14px;color:#888;line-height:1.8;margin-bottom:24px;}

.counter{text-align:center;font-size:12px;color:#bbb;margin-top:6px;}
.loading{text-align:center;padding:32px;color:#aaa;font-size:14px;}
.empty{text-align:center;padding:40px 20px;color:#bbb;font-size:14px;}
.text-input{width:100%;padding:10px 12px;border:2px solid #eee;border-radius:10px;font-size:14px;}
</style>
</head>
<body>

<header>
  <div class="logo">ğŸ’• ä»Šå¤©åƒä»€ä¹ˆ</div>
  <div class="header-btns">
    <button onclick="openSettings()">âš™ï¸ åå¥½</button>
    <button onclick="resetApiKey()">ğŸ”‘ Key</button>
  </div>
</header>

<div id="app">
  <!-- æ¨¡å¼åˆ‡æ¢ -->
  <div class="mode-tabs">
    <button class="mode-tab active" onclick="switchMode('couple',this)">ğŸ’‘ åŒäººæ¨¡å¼</button>
    <button class="mode-tab" onclick="switchMode('solo',this)">ğŸ§‘ å•äººæ¨¡å¼</button>
  </div>

  <!-- å®šä½æ  + æ‰‹åŠ¨è¾“å…¥ -->
  <div class="location-bar">
    <div class="loc-dot" id="locDot"></div>
    <span id="locText" style="flex:1;">å‡†å¤‡å®šä½...</span>
    <button class="loc-btn" onclick="getLocation()" title="è‡ªåŠ¨å®šä½">â†» è‡ªåŠ¨</button>
    <button class="loc-btn" onclick="toggleManualInput()" title="æ‰‹åŠ¨è¾“å…¥">ğŸ“ æ‰‹åŠ¨</button>
  </div>
  <div id="manualInputRow" class="manual-loc-row" style="display:none;">
    <input id="manualAddrInput" placeholder="è¾“å…¥åœ°å€ï¼Œå¦‚ï¼šå—å®å¸‚é’ç§€åŒºä¸‡è¾¾å¹¿åœº" />
    <button onclick="useManualAddr()">ç¡®è®¤</button>
  </div>

  <!-- é¦–é¡µ -->
  <div id="homeSection">
    <div class="meal-card" onclick="showTakeout()">
      <div class="meal-icon">ğŸ›µ</div>
      <div class="meal-info">
        <div class="meal-title">ç‚¹å¤–å–</div>
        <div class="meal-desc">è½¬ç›˜éšæœºæ¨èä¸€é“èœ Â· æœç´¢é™„è¿‘é¤å… Â· ä¸€é”®ä¸‹å•</div>
      </div>
      <div class="meal-arrow">â€º</div>
    </div>
    <div class="meal-card" onclick="showCooking()">
      <div class="meal-icon">ğŸ³</div>
      <div class="meal-info">
        <div class="meal-title">åœ¨å®¶åš</div>
        <div class="meal-desc">æ ¹æ®å®¶ä¹¡æ¨èå®¶å¸¸èœ Â· è¯¦ç»†é£Ÿææ­¥éª¤</div>
      </div>
      <div class="meal-arrow">â€º</div>
    </div>
  </div>

  <!-- å¤–å–åŒºåŸŸ -->
  <div id="takeoutSection" style="display:none;">
    <button class="btn btn-secondary" onclick="backHome()">â† è¿”å›</button>

    <!-- æ— å®šä½æ—¶åŸå¸‚é€‰æ‹© -->
    <div id="citySection" class="card" style="display:none;margin-top:14px;">
      <div class="card-title">ğŸ“ è¯·å…ˆè®¾ç½®ä½ç½®</div>
      <div class="city-grid">
        <button class="city-btn" onclick="pickCity('å—å®',this)">å—å®</button>
        <button class="city-btn" onclick="pickCity('åŒ—äº¬',this)">åŒ—äº¬</button>
        <button class="city-btn" onclick="pickCity('ä¸Šæµ·',this)">ä¸Šæµ·</button>
        <button class="city-btn" onclick="pickCity('å¹¿å·',this)">å¹¿å·</button>
        <button class="city-btn" onclick="pickCity('æ·±åœ³',this)">æ·±åœ³</button>
        <button class="city-btn" onclick="pickCity('æˆéƒ½',this)">æˆéƒ½</button>
        <button class="city-btn" onclick="pickCity('æ­¦æ±‰',this)">æ­¦æ±‰</button>
        <button class="city-btn" onclick="pickCity('æ­å·',this)">æ­å·</button>
      </div>
      <input id="customCity" class="text-input" placeholder="æˆ–è¾“å…¥å…¶ä»–åŸå¸‚" style="margin-top:8px;">
      <button class="btn btn-primary" style="margin-top:10px;" onclick="useCustomCity()">ä½¿ç”¨æ­¤åŸå¸‚</button>
    </div>

    <!-- è½¬ç›˜åŒºåŸŸ -->
    <div class="card" style="margin-top:14px;">
      <div class="card-title">ğŸ¯ é€‰ä¸ªèœç³»ï¼Œè½¬ç›˜å†³å®šåƒä»€ä¹ˆï¼</div>
      <div class="cuisine-filter" id="cuisineFilter">
        <span class="ctag active" onclick="pickCuisine(this,'å…¨éƒ¨')">ğŸ½ éšæœº</span>
        <span class="ctag" onclick="pickCuisine(this,'ç«é”…')">ğŸ² ç«é”…</span>
        <span class="ctag" onclick="pickCuisine(this,'çƒ§çƒ¤')">ğŸ– çƒ§çƒ¤</span>
        <span class="ctag" onclick="pickCuisine(this,'æ—¥æ–™')">ğŸ£ æ—¥æ–™</span>
        <span class="ctag" onclick="pickCuisine(this,'å¿«é¤')">ğŸ” å¿«é¤</span>
        <span class="ctag" onclick="pickCuisine(this,'ç²¥ç²‰é¢')">ğŸœ ç²¥ç²‰é¢</span>
        <span class="ctag" onclick="pickCuisine(this,'è½»é£Ÿ')">ğŸ¥— è½»é£Ÿ</span>
        <span class="ctag" onclick="pickCuisine(this,'éº»è¾£çƒ«')">ğŸŒ¶ éº»è¾£çƒ«</span>
        <span class="ctag" onclick="pickCuisine(this,'çƒ§è…Š')">ğŸ— çƒ§è…Š</span>
        <span class="ctag" onclick="pickCuisine(this,'ç”œå“')">ğŸ§‹ ç”œå“</span>
        <span class="ctag" onclick="pickCuisine(this,'è¥¿é¤')">ğŸ¥© è¥¿é¤</span>
        <span class="ctag" onclick="pickCuisine(this,'ä¸œå—äºš')">ğŸ› ä¸œå—äºš</span>
      </div>

      <!-- è½¬ç›˜ -->
      <div class="wheel-wrap">
        <div class="wheel-outer">
          <div class="wheel-pointer">â–¼</div>
          <canvas id="wheelCanvas" class="wheel-canvas" width="300" height="300"></canvas>
          <button class="wheel-center-btn" onclick="spinWheel()">ğŸ²</button>
        </div>
        <div class="wheel-result" id="wheelResult" style="display:none;">
          <div class="wheel-result-name" id="wrName"></div>
          <div class="wheel-result-cat" id="wrCat"></div>
          <div class="wheel-result-desc" id="wrDesc"></div>
          <button class="btn btn-primary" onclick="searchNearby()">ğŸ” æœç´¢é™„è¿‘èƒ½ç‚¹è¿™é“èœçš„é¤å…</button>
          <button class="btn btn-secondary" onclick="spinWheel()">ğŸ”„ å†è½¬ä¸€æ¬¡</button>
        </div>
        <div class="counter" id="searchCounter"></div>
      </div>
    </div>

    <div id="takeoutResult"></div>
  </div>

  <!-- åœ¨å®¶åšåŒºåŸŸ -->
  <div id="cookingSection" style="display:none;">
    <button class="btn btn-secondary" onclick="backHome()">â† è¿”å›</button>
    <div class="card" style="margin-top:14px;">
      <div class="card-title">ğŸ³ <span id="provinceLabel">å®¶å¸¸èœ</span>æ¨è</div>
      <button class="btn btn-primary" onclick="showRecipes()">âœ¨ å¸®æˆ‘æ¨èä»Šå¤©åšä»€ä¹ˆ</button>
      <div class="counter" id="recipeCounter"></div>
    </div>
    <div id="recipeResult"></div>
  </div>
</div>

<!-- åå¥½è®¾ç½®å¼¹çª— -->
<div class="modal" id="settingsModal">
  <div class="modal-box">
    <div class="modal-handle"></div>
    <div class="modal-title">âš™ï¸ åå¥½è®¾ç½®</div>
    <div class="pref-section">
      <label>ğŸ  å®¶ä¹¡ï¼ˆå½±å“åœ¨å®¶åšæ¨èï¼‰</label>
      <select id="prefProvince" onchange="quickSaveProvince()">
        <option value="">è¯·é€‰æ‹©</option>
        <option value="å·æ¸">å·æ¸ï¼ˆå››å·/é‡åº†ï¼‰</option>
        <option value="å¹¿ä¸œ">å¹¿ä¸œ</option>
        <option value="å¹¿è¥¿">å¹¿è¥¿</option>
        <option value="æ±Ÿæµ™æ²ª">æ±Ÿæµ™æ²ª</option>
        <option value="æ¹–å—">æ¹–å—</option>
        <option value="ä¸œåŒ—">ä¸œåŒ—</option>
        <option value="å±±ä¸œ">å±±ä¸œ</option>
        <option value="é™•è¥¿">é™•è¥¿</option>
        <option value="é€šç”¨">é€šç”¨</option>
      </select>
    </div>
    <div class="pref-section">
      <label>ğŸš« ä¸åƒçš„é£Ÿæ</label>
      <div class="pref-options" id="prefDislikes"></div>
    </div>
    <div class="pref-section">
      <label>ğŸŒ¶ï¸ è¾£åº¦åå¥½</label>
      <div class="pref-options" id="prefSpicy"></div>
    </div>
    <div class="pref-section">
      <label>ğŸ¯ é¥®é£Ÿç›®æ ‡</label>
      <div class="pref-options" id="prefDiet"></div>
    </div>

    <!-- è‡ªå®šä¹‰èœå“ -->
    <div class="pref-section">
      <label>â• è‡ªå®šä¹‰å¤–å–èœå“ï¼ˆä¼šå‡ºç°åœ¨è½¬ç›˜ä¸­ï¼‰</label>
      <div class="custom-dish-list" id="customDishList"></div>
      <div class="add-dish-row">
        <input id="newDishName" placeholder="èœå“åï¼Œå¦‚ï¼šè‡­è±†è…">
        <select id="newDishCat">
          <option value="å…¨éƒ¨">éšæœº</option>
          <option value="ç«é”…">ç«é”…</option>
          <option value="çƒ§çƒ¤">çƒ§çƒ¤</option>
          <option value="æ—¥æ–™">æ—¥æ–™</option>
          <option value="å¿«é¤">å¿«é¤</option>
          <option value="ç²¥ç²‰é¢">ç²¥ç²‰é¢</option>
          <option value="è½»é£Ÿ">è½»é£Ÿ</option>
          <option value="éº»è¾£çƒ«">éº»è¾£çƒ«</option>
          <option value="çƒ§è…Š">çƒ§è…Š</option>
          <option value="ç”œå“">ç”œå“</option>
          <option value="è¥¿é¤">è¥¿é¤</option>
          <option value="ä¸œå—äºš">ä¸œå—äºš</option>
        </select>
        <button onclick="addCustomDish()">æ·»åŠ </button>
      </div>
    </div>

    <button class="btn btn-primary" onclick="saveSettings()">ğŸ’¾ ä¿å­˜è®¾ç½®</button>
    <button class="btn btn-secondary" onclick="closeSettings()">å–æ¶ˆ</button>
  </div>
</div>

<!-- é€‰æ‹©å›°éš¾å¼¹çª— -->
<div class="modal giveup-modal" id="giveupModal">
  <div class="giveup-box">
    <span class="giveup-emoji">ğŸ˜­</span>
    <div class="giveup-title">é€‰æ‹©å›°éš¾ç—‡å‘ä½œå•¦ï¼</div>
    <div class="giveup-text">å·²ç»è½¬äº† <strong id="giveupCount">4</strong> æ¬¡äº†...<br>äººå®¶çœŸçš„å°½åŠ›äº†å‘¢ (ï½¡â€¢Ìï¸¿â€¢Ì€ï½¡)<br>å°±è¿™ä¸ªå§ï¼Ÿ</div>
    <button class="btn btn-primary" onclick="randomFinal()">ğŸ² å°±é€‰è¿™ä¸ªï¼</button>
    <button class="btn btn-secondary" onclick="restartAll()">ğŸ”„ é‡æ–°å¼€å§‹</button>
    <button class="btn btn-secondary" onclick="closeGiveup()">ğŸ‘€ ç»§ç»­çœ‹</button>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  çŠ¶æ€
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let apiKey = localStorage.getItem("amap_api_key");
let prefs  = JSON.parse(localStorage.getItem("prefs")||'{"province":"","dislikes":[],"spicy":"å¾®è¾£","diet":"æ­£å¸¸é¥®é£Ÿ"}');
let customDishes = JSON.parse(localStorage.getItem("customDishes")||"[]");
let loc = null;
let manualCity = "";
let curMode = "couple";
let curCategory = "å…¨éƒ¨";
let spinCount = 0;
let recipeCount = 0;
let curDish = null;
let allPois = [];
let allRecipes = [];
let wheelItems = [];
let wheelAngle = 0;
let isSpinning = false;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  èœå“æ•°æ®åº“ï¼ˆ150é“ï¼‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DISH_DB = {
  "ç«é”…":[
    {name:"æ¯›è‚šç«é”…",emoji:"ğŸ²",desc:"éº»è¾£é²œé¦™ï¼Œæ¯›è‚šè„†å«©ï¼Œé‡åº†ç»å…¸",search:"ç«é”…"},
    {name:"é¸³é¸¯é”…",emoji:"ğŸ«•",desc:"ä¸€åŠçº¢æ±¤ä¸€åŠæ¸…æ±¤ï¼Œç…§é¡¾ä¸¤ç§å£å‘³",search:"ç«é”…"},
    {name:"ç•ªèŒ„ç«é”…",emoji:"ğŸ…",desc:"é…¸ç”œæ¸…çˆ½ä¸ä¸Šç«ï¼Œå¥åº·é¦–é€‰",search:"ç•ªèŒ„ç«é”…"},
    {name:"æ¤°å­é¸¡ç«é”…",emoji:"ğŸ¥¥",desc:"æ¸…ç”œæ¤°æ±åº•æ–™ï¼Œé²œå«©æ— æ¯”",search:"æ¤°å­é¸¡"},
    {name:"çŒªè‚šé¸¡ç«é”…",emoji:"ğŸ”",desc:"æµ“éƒç™½æ±¤ï¼Œæš–èƒƒæ»‹è¡¥",search:"çŒªè‚šé¸¡"},
    {name:"ä¸²ä¸²é¦™",emoji:"ğŸ¢",desc:"ç«é”…å˜ä¸²ä¸²ï¼Œéº»è¾£è¿‡ç˜¾",search:"ä¸²ä¸²é¦™"},
    {name:"ç¾Šèå­é”…",emoji:"ğŸ¦´",desc:"ç¾Šéª¨æµ“æ±¤ï¼Œå†¬å¤©å¿…å¤‡",search:"ç¾Šèå­"},
    {name:"è™¾æ»‘é”…",emoji:"ğŸ¦",desc:"æ–°é²œè™¾æ»‘é…æ¸…æ±¤ï¼Œé²œå«©å¼¹ç‰™",search:"ç«é”…"},
    {name:"é…¸èœç™½è‚‰é”…",emoji:"ğŸ¥¬",desc:"ä¸œåŒ—é£å‘³ï¼Œé…¸çˆ½è§£è…»",search:"é…¸èœç™½è‚‰"},
    {name:"æµ·é²œç«é”…",emoji:"ğŸ¦",desc:"æ–°é²œæµ·é²œæ±‡èšï¼Œé²œå‘³åè¶³",search:"æµ·é²œç«é”…"},
    {name:"è±†æµ†ç«é”…",emoji:"ğŸ¥›",desc:"è±†æµ†åº•æ–™æ¸…ç”œï¼Œè¶Šç…®è¶Šé²œ",search:"ç«é”…"},
    {name:"å†’èœ",emoji:"ğŸŒ¶",desc:"ä¸€äººä»½ç«é”…ï¼Œè‡ªé€‰è‡ªé…æœ€çˆ½",search:"å†’èœ"},
  ],
  "çƒ§çƒ¤":[
    {name:"çƒ¤ç¾Šè‚‰ä¸²",emoji:"ğŸ–",desc:"å­œç„¶è¾£æ¤’ï¼Œå¤–ç„¦é‡Œå«©",search:"çƒ§çƒ¤"},
    {name:"çƒ¤ç”Ÿèš",emoji:"ğŸ¦ª",desc:"è’œè“‰ç²‰ä¸çƒ¤ç”Ÿèšï¼Œé²œå«©å¤šæ±",search:"çƒ¤ç”Ÿèš"},
    {name:"çƒ¤äº”èŠ±è‚‰",emoji:"ğŸ¥©",desc:"é…ç”ŸèœåŒ…ç€åƒï¼Œæ²¹è„‚ä¸°å¯Œ",search:"çƒ§çƒ¤"},
    {name:"çƒ¤é±¿é±¼",emoji:"ğŸ¦‘",desc:"Qå¼¹é²œå«©ï¼Œæµ·é²œå¿…ç‚¹",search:"çƒ¤é±¿é±¼"},
    {name:"çƒ¤ç‰ç±³",emoji:"ğŸŒ½",desc:"åˆ·é»„æ²¹èœ‚èœœï¼Œç”œç³¯é£˜é¦™",search:"çƒ§çƒ¤"},
    {name:"çƒ¤é¸¡ç¿…",emoji:"ğŸ—",desc:"å¤–é…¥é‡Œå«©ï¼Œçƒ§çƒ¤å¿…ç‚¹",search:"çƒ¤é¸¡ç¿…"},
    {name:"çƒ¤éŸ­èœ",emoji:"ğŸŒ¿",desc:"è’œé¦™å››æº¢ï¼Œé…è¾£æ¤’ç²‰",search:"çƒ§çƒ¤"},
    {name:"çƒ¤èŒ„å­",emoji:"ğŸ†",desc:"è½¯ç³¯å…¥å‘³ï¼Œè’œè“‰æé¦™",search:"çƒ¤èŒ„å­"},
    {name:"çƒ¤ç‰›èˆŒ",emoji:"ğŸ®",desc:"å£æ„Ÿç»†è…»ï¼Œè¶Šåš¼è¶Šé¦™",search:"çƒ¤ç‰›è‚‰"},
    {name:"çƒ¤å¤§è™¾",emoji:"ğŸ¦",desc:"é²œç”œå¼¹ç‰™ï¼Œç›´æ¥çƒ¤æœ€å¥½åƒ",search:"çƒ¤å¤§è™¾"},
    {name:"çƒ¤è±†è…",emoji:"ğŸ±",desc:"å¤–è„†é‡Œå«©ï¼Œè˜¸è¾£æ¤’é…±",search:"çƒ§çƒ¤"},
    {name:"ç¢³çƒ¤æ‰‡è´",emoji:"ğŸš",desc:"ç²‰ä¸è’œè“‰ï¼Œé²œç¾æ— æ¯”",search:"çƒ¤æ‰‡è´"},
  ],
  "æ—¥æ–™":[
    {name:"ä¸‰æ–‡é±¼åˆºèº«",emoji:"ğŸ£",desc:"æ–°é²œè‚¥ç¾ï¼Œå…¥å£å³åŒ–",search:"æ—¥æ–™"},
    {name:"æµ·é²œæ‹‰é¢",emoji:"ğŸœ",desc:"æµ“éƒæ±¤åº•é…ä¸°å¯Œæµ·é²œ",search:"æ‹‰é¢"},
    {name:"å¯¿å¸æ‹¼ç›˜",emoji:"ğŸ±",desc:"å„ç§å£å‘³ä¸€æ¬¡æ»¡è¶³",search:"å¯¿å¸"},
    {name:"ç‚¸çŒªæ’é¥­",emoji:"ğŸ›",desc:"é…¥è„†çŒªæ’é…è›‹æ±ç±³é¥­",search:"çŒªæ’é¥­"},
    {name:"å¤©å¦‡ç½—",emoji:"ğŸ¤",desc:"è½»ç›ˆé…¥è„†ï¼Œè˜¸æ±æ›´ç¾",search:"å¤©å¦‡ç½—"},
    {name:"ç‰›è‚‰ä¸¼",emoji:"ğŸ¥©",desc:"å«©æ»‘ç‰›è‚‰é“ºç±³é¥­",search:"ç‰›è‚‰ä¸¼"},
    {name:"äº²å­ä¸¼",emoji:"ğŸ”",desc:"é¸¡è‚‰é¸¡è›‹åŒç¢—ï¼Œæ¸©æš–æ²»æ„ˆ",search:"äº²å­ä¸¼"},
    {name:"é³—é±¼é¥­",emoji:"ğŸŸ",desc:"è’²çƒ§é³—é±¼ï¼Œé¦™ç”œè½¯ç³¯",search:"é³—é±¼é¥­"},
    {name:"ç« é±¼çƒ§",emoji:"ğŸ™",desc:"å¤–è„†å†…å«©ï¼Œè¡—å¤´å°é£Ÿ",search:"ç« é±¼çƒ§"},
    {name:"å‘³å™Œæ‹‰é¢",emoji:"ğŸœ",desc:"æµ“éƒå’¸é¦™ï¼Œç»å…¸å£å‘³",search:"æ‹‰é¢"},
    {name:"æ‰‹å·å¯¿å¸",emoji:"ğŸŒ¯",desc:"æ–°é²œé£Ÿæå·èµ·æ¥åƒ",search:"å¯¿å¸"},
    {name:"æ—¥å¼å”æ‰¬ç‚¸é¸¡",emoji:"ğŸ—",desc:"å¤–é…¥é‡Œå«©ï¼Œé…æŸ æª¬æ±",search:"æ—¥æ–™ç‚¸é¸¡"},
  ],
  "å¿«é¤":[
    {name:"æ±‰å ¡",emoji:"ğŸ”",desc:"ç»å…¸ç‰›è‚‰æ±‰å ¡ï¼Œé…è–¯æ¡å¯ä¹",search:"æ±‰å ¡"},
    {name:"ç‚¸é¸¡",emoji:"ğŸ—",desc:"å¤–çš®é…¥è„†ï¼Œé¦™è¾£å¤šæ±",search:"ç‚¸é¸¡"},
    {name:"æŠ«è¨",emoji:"ğŸ•",desc:"åšåº•èŠå£«ï¼Œé…æ–™ä¸°å¯Œ",search:"æŠ«è¨"},
    {name:"é¸¡è‚‰å·",emoji:"ğŸŒ¯",desc:"å«©é¸¡é…è”¬èœåŒ…è–„é¥¼",search:"é¸¡è‚‰å·"},
    {name:"è–¯æ¡",emoji:"ğŸŸ",desc:"é»„é‡‘é…¥è„†ï¼Œç™¾åƒä¸åŒ",search:"è–¯æ¡"},
    {name:"çƒ­ç‹—",emoji:"ğŸŒ­",desc:"ç»å…¸ç¾å¼ï¼Œé…èŠ¥æœ«ç•ªèŒ„é…±",search:"çƒ­ç‹—"},
    {name:"å¢¨è¥¿å“¥å·é¥¼",emoji:"ğŸ«”",desc:"é¦™è¾£ç‰›è‚‰é…è”¬èœï¼Œé¥±è…¹æ„Ÿå¼º",search:"å¢¨è¥¿å“¥å·é¥¼"},
    {name:"é¸¡å—",emoji:"ğŸ—",desc:"Qå¼¹å¤šæ±ï¼Œè˜¸é…±è¶…å¥½åƒ",search:"éº¦å½“åŠ³"},
    {name:"é¸¡è›‹æ±‰å ¡",emoji:"ğŸ”",desc:"å«©è›‹é…é…±ï¼Œç®€å•æ»¡è¶³",search:"æ±‰å ¡"},
    {name:"çƒ¤ç¿…",emoji:"ğŸ—",desc:"å¿«é¤ç‰ˆçƒ¤é¸¡ç¿…ï¼Œæ–¹ä¾¿å¿«æ·",search:"è‚¯å¾·åŸº"},
    {name:"é±¼æŸ³å ¡",emoji:"ğŸŸ",desc:"å«©æ»‘é±¼æŸ³é…é…±æ±",search:"é±¼æŸ³å ¡"},
    {name:"èŠå£«æ±‰å ¡",emoji:"ğŸ”",desc:"åŒå±‚èŠå£«æ‹‰ä¸ï¼Œæ»¡è¶³æ„Ÿçˆ†æ£š",search:"èŠå£«æ±‰å ¡"},
  ],
  "ç²¥ç²‰é¢":[
    {name:"èºè›³ç²‰",emoji:"ğŸœ",desc:"é…¸è¾£é²œé¦™ï¼Œé…é…¸ç¬‹è…ç«¹èŠ±ç”Ÿ",search:"èºè›³ç²‰"},
    {name:"ç‰›è‚‰ç²‰",emoji:"ğŸ„",desc:"æµ“éƒç‰›éª¨æ±¤ï¼Œå«©æ»‘ç‰›è‚‰ç‰‡",search:"ç‰›è‚‰ç²‰"},
    {name:"çš®è›‹ç˜¦è‚‰ç²¥",emoji:"ğŸ¥£",desc:"ç»µæ»‘ç»†è…»ï¼Œå¹¿å¼ç»å…¸",search:"ç²¥"},
    {name:"é‡åº†å°é¢",emoji:"ğŸ",desc:"éº»è¾£é²œé¦™ï¼Œé…è±Œè±†è‘±èŠ±",search:"é‡åº†å°é¢"},
    {name:"äº‘åé¢",emoji:"ğŸœ",desc:"è™¾è‚‰äº‘åé…ç»†é¢ï¼Œé²œç¾çˆ½æ»‘",search:"äº‘åé¢"},
    {name:"è¿‡æ¡¥ç±³çº¿",emoji:"ğŸ²",desc:"äº‘å—ç‰¹è‰²ï¼Œè‡ªå·±çƒ«ç†Ÿçš„ä¹è¶£",search:"ç±³çº¿"},
    {name:"çƒ­å¹²é¢",emoji:"ğŸœ",desc:"æ­¦æ±‰ç‰¹è‰²ï¼ŒèŠéº»é…±æ‹Œé¢",search:"çƒ­å¹²é¢"},
    {name:"å…°å·æ‹‰é¢",emoji:"ğŸœ",desc:"ä¸€æ¸…äºŒç™½ä¸‰çº¢å››ç»¿ï¼Œç‰›è‚‰æ±¤åº•",search:"å…°å·æ‹‰é¢"},
    {name:"åˆ€å‰Šé¢",emoji:"ğŸœ",desc:"å±±è¥¿ç‰¹è‰²ï¼Œæ±¤æ±æµ“éƒ",search:"åˆ€å‰Šé¢"},
    {name:"è‚ ç²‰",emoji:"ğŸš",desc:"å¹¿å¼æ—©èŒ¶å¿…ç‚¹ï¼Œé²œæ»‘é¡ºå£",search:"è‚ ç²‰"},
    {name:"ç‚¸é…±é¢",emoji:"ğŸ",desc:"è€åŒ—äº¬ç»å…¸ï¼Œè‚‰é…±æµ“éƒ",search:"ç‚¸é…±é¢"},
    {name:"çŒªè„šç²‰",emoji:"ğŸ·",desc:"è½¯ç³¯çŒªè„šé…ç²‰ï¼Œå—å®ç‰¹è‰²",search:"çŒªè„šç²‰"},
  ],
  "è½»é£Ÿ":[
    {name:"é¸¡èƒ¸è‚‰æ²™æ‹‰",emoji:"ğŸ¥—",desc:"ä½å¡é«˜è›‹ç™½ï¼Œæ¸…çˆ½å¥åº·",search:"æ²™æ‹‰"},
    {name:"ä¸‰æ˜æ²»",emoji:"ğŸ¥ª",desc:"å…¨éº¦ä¸‰æ˜æ²»ï¼Œè¥å…»å‡è¡¡",search:"ä¸‰æ˜æ²»"},
    {name:"è—œéº¦ç¢—",emoji:"ğŸ«™",desc:"è¶…çº§é£Ÿç‰©ï¼Œæ­é…æ—¶è”¬",search:"è½»é£Ÿ"},
    {name:"ç‰›æ²¹æœåå¸",emoji:"ğŸ¥‘",desc:"ç½‘çº¢æ—©åˆé¤ï¼Œå£æ„Ÿä¸°å¯Œ",search:"è½»é£Ÿ"},
    {name:"é²œæ¦¨æœæ±+ç‡•éº¦",emoji:"ğŸ¥¤",desc:"æ¸…çˆ½ç»„åˆï¼Œå…ƒæ°”å¼€å§‹",search:"è½»é£Ÿ"},
    {name:"è—•ç²‰",emoji:"ğŸ®",desc:"æ¸…æ·¡æ»‹è¡¥ï¼Œé¥±è…¹æ„Ÿå¼º",search:"è½»é£Ÿ"},
    {name:"è”¬èœé¥­å›¢",emoji:"ğŸ™",desc:"æ—¥å¼é¥­å›¢ï¼Œä¾¿æºå¥åº·",search:"é¥­å›¢"},
    {name:"å‡¯æ’’æ²™æ‹‰",emoji:"ğŸ¥—",desc:"è„†ç”Ÿèœé…å¸•ç›æ£®èŠå£«",search:"æ²™æ‹‰"},
    {name:"ç´ é£Ÿå¯¿å¸",emoji:"ğŸ±",desc:"è”¬èœä¸ºä¸»ï¼Œæ¸…æ·¡ç¾å‘³",search:"è½»é£Ÿ"},
    {name:"é¸¡è›‹ç¾¹",emoji:"ğŸ¥š",desc:"å«©æ»‘é¸¡è›‹ç¾¹ï¼Œç®€å•æ²»æ„ˆ",search:"è½»é£Ÿ"},
    {name:"æ°´æœéº¦ç‰‡",emoji:"ğŸ«",desc:"é…¸å¥¶é…æ–°é²œæ°´æœéº¦ç‰‡",search:"è½»é£Ÿ"},
    {name:"è±†è…é¥­",emoji:"ğŸ¥¡",desc:"ä½çƒ­é‡è±†è…é…æ‚ç²®é¥­",search:"è½»é£Ÿ"},
  ],
  "éº»è¾£çƒ«":[
    {name:"éº»è¾£çƒ«",emoji:"ğŸŒ¶",desc:"è‡ªé€‰é£Ÿæï¼Œéº»è¾£é²œé¦™",search:"éº»è¾£çƒ«"},
    {name:"å†’èœ",emoji:"ğŸ²",desc:"ä¸€äººä»½ç«é”…ï¼Œè¶…çº§æ»¡è¶³",search:"å†’èœ"},
    {name:"é…¸è¾£ç²‰",emoji:"ğŸœ",desc:"Qå¼¹ç²‰æ¡ï¼Œé…¸è¾£å¼€èƒƒ",search:"é…¸è¾£ç²‰"},
    {name:"éº»è¾£é¦™é”…",emoji:"ğŸ¥˜",desc:"å¹²é”…ç‰ˆï¼Œæ±¤æ±å°‘æ›´å…¥å‘³",search:"éº»è¾£é¦™é”…"},
    {name:"å†·ä¸²ä¸²",emoji:"ğŸ¢",desc:"å‡‰æ‹Œç‰ˆä¸²ä¸²ï¼Œå¤æ—¥ç‰¹è‰²",search:"å†·ä¸²ä¸²"},
    {name:"é±¼è›‹ç²‰",emoji:"ğŸŸ",desc:"é¦™æ¸¯é£å‘³é±¼è›‹ï¼Œå¼¹ç‰™é²œç¾",search:"é±¼è›‹ç²‰"},
    {name:"ç µä»”ç³•",emoji:"ğŸ®",desc:"è¡—è¾¹å°é£Ÿï¼ŒQå¼¹ç”œç³¯",search:"ç µä»”ç³•"},
    {name:"é’µé’µé¸¡",emoji:"ğŸ”",desc:"å››å·ç‰¹è‰²ï¼Œéº»è¾£é²œé¦™",search:"é’µé’µé¸¡"},
    {name:"æ¨å›½ç¦éº»è¾£çƒ«",emoji:"ğŸŒ¶",desc:"åŠ éº»é…±çš„ç‰¹è‰²éº»è¾£çƒ«",search:"æ¨å›½ç¦"},
    {name:"å¼ äº®éº»è¾£çƒ«",emoji:"ğŸ²",desc:"éª¨æ±¤åº•æ–™ï¼Œé²œé¦™ä¸ä¸Šç«",search:"å¼ äº®éº»è¾£çƒ«"},
  ],
  "çƒ§è…Š":[
    {name:"çƒ§é¸­é¥­",emoji:"ğŸ¦†",desc:"çš®è„†è‚‰å«©ï¼Œå¹¿å¼ç»å…¸",search:"çƒ§é¸­"},
    {name:"å‰çƒ§é¥­",emoji:"ğŸ–",desc:"èœœæ±ç„¦é¦™ï¼Œç™¾åƒä¸åŒ",search:"å‰çƒ§"},
    {name:"ç™½åˆ‡é¸¡é¥­",emoji:"ğŸ”",desc:"çš®æ»‘è‚‰å«©ï¼Œè˜¸å§œè‘±é…±",search:"ç™½åˆ‡é¸¡"},
    {name:"çƒ§è‚‰é¥­",emoji:"ğŸ¥©",desc:"è„†çš®çƒ§è‚‰ï¼Œçš®é…¥è‚‰é¦™",search:"çƒ§è‚‰"},
    {name:"å¤é¹…é¥­",emoji:"ğŸ¦¢",desc:"æ½®æ±•å¤é¹…ï¼Œå¤æ±æµ“éƒ",search:"å¤é¹…"},
    {name:"è±‰æ²¹é¸¡é¥­",emoji:"ğŸ”",desc:"é…±é¦™æµ“éƒï¼Œè‚‰è´¨å«©æ»‘",search:"è±‰æ²¹é¸¡"},
    {name:"çƒ§ä¹³çŒª",emoji:"ğŸ·",desc:"å¤–çš®é…¥è„†ï¼Œè‚‰è´¨å«©æ»‘",search:"çƒ§ä¹³çŒª"},
    {name:"å¤çŒªè„šé¥­",emoji:"ğŸ·",desc:"è½¯ç³¯å…¥å‘³ï¼Œèƒ¶è´¨ä¸°å¯Œ",search:"å¤çŒªè„š"},
    {name:"ç›ç„—é¸¡",emoji:"ğŸ—",desc:"ç›é¦™å››æº¢ï¼Œçš®è„†è‚‰å«©",search:"ç›ç„—é¸¡"},
    {name:"çƒ¤ä¹³é¸½",emoji:"ğŸ¦",desc:"çš®è„†éª¨é…¥ï¼Œå¹¿å¼åèœ",search:"çƒ¤ä¹³é¸½"},
  ],
  "ç”œå“":[
    {name:"èŠ’æœç­æˆŸ",emoji:"ğŸ¥­",desc:"è½¯ç³¯ç­æˆŸçš®åŒ…æ–°é²œèŠ’æœå¥¶æ²¹",search:"ç”œå“"},
    {name:"å¥¶èŒ¶",emoji:"ğŸ§‹",desc:"çç å¥¶èŒ¶ï¼Œä¸‹åˆèŒ¶å¿…å¤‡",search:"å¥¶èŒ¶"},
    {name:"å†°æ·‡æ·‹",emoji:"ğŸ¦",desc:"å¤šç§å£å‘³ï¼Œå¤æ—¥å¿…å¤‡",search:"å†°æ·‡æ·‹"},
    {name:"æ¨æç”˜éœ²",emoji:"ğŸ¥­",desc:"èŠ’æœæ¤°å¥¶è¥¿ç±³ï¼Œæ¸…ç”œè§£æš‘",search:"ç”œå“"},
    {name:"è›‹ç³•",emoji:"ğŸ‚",desc:"æˆšé£è›‹ç³•æˆ–æ…•æ–¯ï¼Œè½¯ç»µå¯å£",search:"è›‹ç³•"},
    {name:"çº¢è±†æ²™",emoji:"ğŸ®",desc:"å¹¿å¼ç³–æ°´ï¼Œæš–å¿ƒæš–èƒƒ",search:"ç³–æ°´"},
    {name:"åŒçš®å¥¶",emoji:"ğŸ¥›",desc:"é¡ºæ»‘å«©ç™½ï¼Œå¹¿å¼ç»å…¸ç”œå“",search:"åŒçš®å¥¶"},
    {name:"æ±¤åœ†",emoji:"âšª",desc:"ç³¯ç±³åŒ…è±†æ²™ï¼Œç”œèœœè½¯ç³¯",search:"æ±¤åœ†"},
    {name:"å¸ƒä¸",emoji:"ğŸ®",desc:"å«©æ»‘å¸ƒä¸ï¼Œç„¦ç³–é¦™ç”œ",search:"å¸ƒä¸"},
    {name:"å¯ä¸½é¥¼",emoji:"ğŸ¥",desc:"è–„è„†é¥¼çš®é…å„ç§é¦…æ–™",search:"å¯ä¸½é¥¼"},
    {name:"å†°æ²™",emoji:"ğŸ§",desc:"ç»µå¯†å†°æ²™é…å„ç§æ–™",search:"åˆ¨å†°"},
    {name:"èŠéº»ç³Š",emoji:"âš«",desc:"æµ“éƒèŠéº»é¦™ï¼Œå†¬æ—¥æš–å“",search:"ç³–æ°´"},
  ],
  "è¥¿é¤":[
    {name:"ç‰›æ’",emoji:"ğŸ¥©",desc:"åšåˆ‡ç‰›æ’ï¼Œå¤–ç„¦é‡Œå«©",search:"ç‰›æ’"},
    {name:"æ„å¤§åˆ©é¢",emoji:"ğŸ",desc:"ç•ªèŒ„è‚‰é…±é¢ï¼Œæµ“éƒé²œç¾",search:"æ„å¤§åˆ©é¢"},
    {name:"çƒ¤é¸¡è…¿",emoji:"ğŸ—",desc:"é¦™è‰è…Œåˆ¶çƒ¤é¸¡ï¼Œå¤–çš®é‡‘é»„",search:"è¥¿é¤"},
    {name:"æ³•å¼æ´‹è‘±æ±¤",emoji:"ğŸ§…",desc:"æµ“éƒæ´‹è‘±æ±¤é…èŠå£«é¢åŒ…",search:"è¥¿é¤"},
    {name:"æµ·é²œæ„é¢",emoji:"ğŸ¦",desc:"é»‘æ¤’æˆ–ç™½é…±æµ·é²œæ„é¢",search:"æµ·é²œæ„é¢"},
    {name:"çƒ¤ä¸‰æ–‡é±¼",emoji:"ğŸŸ",desc:"æŸ æª¬é»„æ²¹çƒ¤ä¸‰æ–‡é±¼",search:"ä¸‰æ–‡é±¼"},
    {name:"ç¾Šæ’",emoji:"ğŸ¥©",desc:"è¿·è¿­é¦™çƒ¤ç¾Šæ’ï¼Œå¤–ç„¦é‡Œå«©",search:"ç¾Šæ’"},
    {name:"åŸ¹æ ¹è›‹é»„é¢",emoji:"ğŸ",desc:"å¡é‚¦å°¼æ„é¢ï¼Œå¥¶é¦™æµ“éƒ",search:"æ„å¤§åˆ©é¢"},
    {name:"ç‚¸è–¯é¥¼é…åŸ¹æ ¹",emoji:"ğŸ¥“",desc:"è¥¿å¼æ—©åˆé¤ï¼Œå…ƒæ°”æ»¡æ»¡",search:"è¥¿é¤"},
    {name:"é¸¡è‚‰å‡¯æ’’æ²™æ‹‰",emoji:"ğŸ¥—",desc:"çƒ¤é¸¡é…å¸•ç›æ£®èŠå£«è„†é¢åŒ…",search:"è¥¿é¤æ²™æ‹‰"},
    {name:"è˜‘è‡çƒ©é¥­",emoji:"ğŸ„",desc:"å¥¶æ²¹è˜‘è‡çƒ©é¥­ï¼Œæµ“éƒé†‡é¦™",search:"çƒ©é¥­"},
    {name:"ç„—é¾™è™¾",emoji:"ğŸ¦",desc:"èŠå£«ç„—é¾™è™¾ï¼Œå¥¢åäº«å—",search:"é¾™è™¾"},
  ],
  "ä¸œå—äºš":[
    {name:"è¶Šå—æ²³ç²‰",emoji:"ğŸœ",desc:"æ¸…æ¾ˆç‰›éª¨æ±¤ï¼Œé…æ–°é²œé¦™è‰",search:"è¶Šå—ç²‰"},
    {name:"æ³°å¼ç‚’æ²³ç²‰",emoji:"ğŸœ",desc:"é…¸ç”œè¾£ç‚’ç²‰ï¼Œé…èŠ±ç”Ÿç¢",search:"æ³°å›½èœ"},
    {name:"æ¤°æ±å’–å–±é¸¡",emoji:"ğŸ›",desc:"æµ“éƒæ¤°é¦™å’–å–±ï¼Œé¦™è¾£è¯±äºº",search:"å’–å–±"},
    {name:"å†¬é˜´åŠŸæ±¤",emoji:"ğŸ²",desc:"é…¸è¾£é²œç¾çš„æ³°å¼æ±¤ï¼Œå¼€èƒƒ",search:"æ³°å›½èœ"},
    {name:"æ²™å—²ä¸²",emoji:"ğŸ¢",desc:"æ¤°å¥¶è…Œåˆ¶çƒ¤ä¸²ï¼Œè˜¸èŠ±ç”Ÿé…±",search:"ä¸œå—äºš"},
    {name:"å»æ²™",emoji:"ğŸœ",desc:"æ–°åŠ å¡ç‰¹è‰²æ¤°æµ†æ±¤åº•ç±³ç²‰",search:"å»æ²™"},
    {name:"é©¬æ¥å’–å–±é¥­",emoji:"ğŸ›",desc:"é¦™æ–™ä¸°å¯Œï¼Œé…ç‚¸é¸¡æˆ–è™¾",search:"å’–å–±é¥­"},
    {name:"èŠ’æœç³¯ç±³é¥­",emoji:"ğŸ¥­",desc:"æ³°å¼ç”œå“ï¼Œæ¤°å¥¶æµ‡æ±",search:"æ³°å›½ç”œå“"},
    {name:"è èç‚’é¥­",emoji:"ğŸ",desc:"ç”¨è èå£³è£…çš„ç‚’é¥­ï¼Œé¦™ç”œ",search:"è èç‚’é¥­"},
    {name:"è¶Šå—æ˜¥å·",emoji:"ğŸŒ¯",desc:"æ–°é²œè”¬èœå·ï¼Œæ¸…çˆ½å¥åº·",search:"è¶Šå—èœ"},
    {name:"çŒªè„šé¥­ï¼ˆé©¬æ¥å¼ï¼‰",emoji:"ğŸ·",desc:"å¤çŒªè¹„é…ç±³é¥­ï¼Œè½¯ç³¯å…¥å‘³",search:"çŒªè„šé¥­"},
    {name:"æµ·å—é¸¡é¥­",emoji:"ğŸ”",desc:"å«©æ»‘é¸¡è‚‰é…é¸¡æ²¹é¥­",search:"æµ·å—é¸¡é¥­"},
  ],
};

// è·å–å½“å‰èœå“æ± ï¼ˆå«è‡ªå®šä¹‰ï¼‰
function getDishPool(category){
  let pool;
  if(category==="å…¨éƒ¨"){
    pool = Object.values(DISH_DB).flat();
  } else {
    pool = DISH_DB[category] || [];
  }
  // åŠ å…¥è‡ªå®šä¹‰èœå“
  const custom = customDishes.filter(d=> category==="å…¨éƒ¨" || d.category===category || d.category==="å…¨éƒ¨");
  return [...pool, ...custom.map(d=>({name:d.name,emoji:"âœ¨",desc:"è‡ªå®šä¹‰èœå“",search:d.name}))];
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  åˆå§‹åŒ–
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.onload = () => {
  if(!apiKey){
    apiKey = prompt("ğŸ”‘ è¯·è¾“å…¥é«˜å¾·åœ°å›¾ Web æœåŠ¡ API Key\n\nè·å–åœ°å€ï¼šhttps://lbs.amap.com/");
    if(apiKey) localStorage.setItem("amap_api_key",apiKey);
  }
  buildPrefUI();
  renderCustomDishList();
  if(prefs.province){ document.getElementById("prefProvince").value=prefs.province; updateProvinceLabel(); }
  getLocation();
  drawWheel("å…¨éƒ¨");
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  å®šä½
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getLocation(){
  setLoc("spin","è‡ªåŠ¨å®šä½ä¸­...");
  if(!navigator.geolocation){ setLoc("fail","ä¸æ”¯æŒå®šä½"); return; }
  navigator.geolocation.getCurrentPosition(
    pos=>{ loc={lat:pos.coords.latitude,lng:pos.coords.longitude}; setLoc("ok","ğŸ“ å®šä½æˆåŠŸ"); },
    ()=>{ loc=null; setLoc("fail","å®šä½å¤±è´¥ï¼Œå¯æ‰‹åŠ¨è¾“å…¥"); },
    {timeout:8000}
  );
}
function setLoc(s,t){
  document.getElementById("locDot").className="loc-dot "+(s==="ok"?"ok":s==="spin"?"spin":"fail");
  document.getElementById("locText").textContent=t;
}

// æ‰‹åŠ¨è¾“å…¥åœ°å€
function toggleManualInput(){
  const row=document.getElementById("manualInputRow");
  row.style.display=row.style.display==="none"?"flex":"none";
}
async function useManualAddr(){
  const addr=document.getElementById("manualAddrInput").value.trim();
  if(!addr){alert("è¯·è¾“å…¥åœ°å€");return;}
  setLoc("spin","è§£æåœ°å€...");
  try{
    const d=await fetch(`https://restapi.amap.com/v3/geocode/geo?key=${apiKey}&address=${encodeURIComponent(addr)}`).then(r=>r.json());
    if(d.status==="1"&&d.geocodes?.length){
      const[lng,lat]=d.geocodes[0].location.split(",").map(Number);
      loc={lat,lng};
      setLoc("ok","ğŸ“ "+addr.slice(0,16)+(addr.length>16?"...":""));
      document.getElementById("manualInputRow").style.display="none";
      document.getElementById("citySection").style.display="none";
    } else { setLoc("fail","åœ°å€è§£æå¤±è´¥ï¼Œè¯·é‡è¯•"); }
  } catch(e){ setLoc("fail","è¯·æ±‚å¤±è´¥ï¼š"+e.message); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  API Key
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function resetApiKey(){
  if(confirm("ç¡®å®šé‡ç½® API Keyï¼Ÿ")){localStorage.removeItem("amap_api_key");location.reload();}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  æ¨¡å¼ & å¯¼èˆª
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchMode(m,btn){
  curMode=m;
  document.querySelectorAll(".mode-tab").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
}
function showTakeout(){
  document.getElementById("homeSection").style.display="none";
  document.getElementById("takeoutSection").style.display="block";
  document.getElementById("cookingSection").style.display="none";
  if(!loc&&!manualCity) document.getElementById("citySection").style.display="block";
  spinCount=0;
  document.getElementById("searchCounter").textContent="";
  drawWheel(curCategory);
}
function showCooking(){
  document.getElementById("homeSection").style.display="none";
  document.getElementById("takeoutSection").style.display="none";
  document.getElementById("cookingSection").style.display="block";
  recipeCount=0;
}
function backHome(){
  document.getElementById("homeSection").style.display="block";
  document.getElementById("takeoutSection").style.display="none";
  document.getElementById("cookingSection").style.display="none";
  document.getElementById("takeoutResult").innerHTML="";
  document.getElementById("recipeResult").innerHTML="";
  spinCount=0; recipeCount=0;
}
function pickCity(city,btn){
  manualCity=city;
  document.querySelectorAll(".city-btn").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
  document.getElementById("citySection").style.display="none";
}
function useCustomCity(){
  const v=document.getElementById("customCity").value.trim();
  if(!v){alert("è¯·è¾“å…¥åŸå¸‚");return;}
  manualCity=v;
  document.getElementById("citySection").style.display="none";
}
function pickCuisine(el,cat){
  document.querySelectorAll(".ctag").forEach(t=>t.classList.remove("active"));
  el.classList.add("active");
  curCategory=cat;
  drawWheel(cat);
  document.getElementById("wheelResult").style.display="none";
  document.getElementById("takeoutResult").innerHTML="";
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  è½¬ç›˜
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const WHEEL_COLORS = [
  "#ff6b81","#ff8fa3","#ffc0cb","#ffb347","#87ceeb",
  "#98fb98","#dda0dd","#f0e68c","#ff9999","#b0e0e6",
  "#ffcc99","#c8a2c8"
];

function drawWheel(category){
  const canvas=document.getElementById("wheelCanvas");
  const ctx=canvas.getContext("2d");
  const W=canvas.width, R=W/2;

  let pool=getDishPool(category).slice(0,12);
  if(!pool.length) pool=[{name:"éšæœºèœå“",emoji:"ğŸ½"}];
  wheelItems=pool;

  ctx.clearRect(0,0,W,W);
  const seg=2*Math.PI/pool.length;

  pool.forEach((item,i)=>{
    const start=i*seg+wheelAngle;
    const end=start+seg;
    ctx.beginPath();
    ctx.moveTo(R,R);
    ctx.arc(R,R,R-2,start,end);
    ctx.closePath();
    ctx.fillStyle=WHEEL_COLORS[i%WHEEL_COLORS.length];
    ctx.fill();
    ctx.strokeStyle="white";
    ctx.lineWidth=2;
    ctx.stroke();

    // æ–‡å­—
    ctx.save();
    ctx.translate(R,R);
    ctx.rotate(start+seg/2);
    ctx.textAlign="right";
    ctx.fillStyle="white";
    ctx.font=`bold ${pool.length>8?11:13}px Inter,sans-serif`;
    ctx.shadowColor="rgba(0,0,0,0.3)";
    ctx.shadowBlur=3;
    ctx.fillText(item.emoji+" "+item.name, R-10, 4);
    ctx.restore();
  });
}

function spinWheel(){
  if(isSpinning) return;
  spinCount++;
  if(spinCount>4){
    document.getElementById("giveupCount").textContent=spinCount;
    openGiveup(); return;
  }
  document.getElementById("searchCounter").textContent=spinCount>1?`å·²è½¬ ${spinCount} æ¬¡`:"";
  document.getElementById("wheelResult").style.display="none";
  document.getElementById("takeoutResult").innerHTML="";

  isSpinning=true;
  const pool=wheelItems;
  const totalSpin = 3*2*Math.PI + Math.random()*2*Math.PI; // 3åœˆ+éšæœº
  const duration = 3000;
  const start=performance.now();
  const startAngle=wheelAngle;

  function animate(now){
    const elapsed=now-start;
    const t=Math.min(elapsed/duration,1);
    const ease=1-Math.pow(1-t,4); // easeOutQuart
    wheelAngle=startAngle+totalSpin*ease;
    drawWheel(curCategory);

    if(t<1){
      requestAnimationFrame(animate);
    } else {
      isSpinning=false;
      // è®¡ç®—æŒ‡é’ˆæŒ‡å‘å“ªä¸ªæ ¼å­ï¼ˆæŒ‡é’ˆåœ¨é¡¶éƒ¨ -Ï€/2ï¼‰
      const seg=2*Math.PI/pool.length;
      const normalAngle = (((-wheelAngle - Math.PI/2) % (2*Math.PI)) + 2*Math.PI) % (2*Math.PI);
      const idx=Math.floor(normalAngle/seg) % pool.length;
      curDish=pool[idx];
      showDishResult(curDish);
    }
  }
  requestAnimationFrame(animate);
}

function showDishResult(dish){
  document.getElementById("wrName").textContent=dish.emoji+" "+dish.name;
  document.getElementById("wrCat").textContent= curMode==="couple"?"ğŸ’‘ ä»Šæ™šå°±åƒè¿™ä¸ªï¼":"ğŸ§‘ ä»Šå¤©å°±åƒè¿™ä¸ªï¼";
  document.getElementById("wrDesc").textContent=dish.desc||"";
  document.getElementById("wheelResult").style.display="block";
  document.getElementById("wheelResult").scrollIntoView({behavior:"smooth",block:"nearest"});
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  æœç´¢é™„è¿‘é¤å…
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function searchNearby(){
  if(!curDish){alert("è¯·å…ˆè½¬ç›˜é€‰èœ");return;}
  if(!loc&&!manualCity){
    document.getElementById("citySection").style.display="block";
    document.getElementById("citySection").scrollIntoView({behavior:"smooth"});
    return;
  }
  document.getElementById("takeoutResult").innerHTML=`<div class="loading">ğŸ” æœç´¢é™„è¿‘èƒ½ç‚¹ã€Œ${curDish.name}ã€çš„é¤å…...</div>`;
  try{
    let url;
    if(loc){
      url=`https://restapi.amap.com/v3/place/around?key=${apiKey}&location=${loc.lng},${loc.lat}&keywords=${encodeURIComponent(curDish.search||curDish.name)}&types=050000|060000&radius=3000&sortrule=distance&offset=15&extensions=all`;
    } else {
      url=`https://restapi.amap.com/v3/place/text?key=${apiKey}&keywords=${encodeURIComponent(curDish.search||curDish.name)}&city=${encodeURIComponent(manualCity)}&types=050000|060000&offset=15&extensions=all`;
    }
    const data=await fetch(url).then(r=>r.json());
    if(data.status==="1"&&data.pois?.length){
      allPois=data.pois;
      renderPoisForDish(allPois);
    } else {
      document.getElementById("takeoutResult").innerHTML=`<div class="empty">ğŸ˜• é™„è¿‘æ²¡æ‰¾åˆ°ã€Œ${curDish.name}ã€ç›¸å…³é¤å…<br>æ¢ä¸€é“èœè¯•è¯•ï¼Ÿ</div>`;
    }
  } catch(e){
    document.getElementById("takeoutResult").innerHTML=`<div class="empty">âŒ æœç´¢å¤±è´¥<br>${e.message}</div>`;
  }
}

function renderPoisForDish(pois){
  const CUISINE_MAP=[
    {key:"ğŸ² ç«é”…/ä¸²ä¸²",tags:["ç«é”…","ä¸²ä¸²","å†’èœ","éº»è¾£çƒ«"]},
    {key:"ğŸ– çƒ§çƒ¤",tags:["çƒ§çƒ¤","çƒ¤è‚‰","å¤œå®µ"]},
    {key:"ğŸ£ æ—¥æ–™",tags:["å¯¿å¸","æ—¥å¼","æ—¥æ–™","æ‹‰é¢","å±…é…’å±‹"]},
    {key:"ğŸœ ç²¥ç²‰é¢",tags:["ç²¥","ç²‰","é¢","ç±³çº¿","èºè›³","æ²³ç²‰"]},
    {key:"ğŸ— çƒ§è…Š",tags:["çƒ§è…Š","çƒ§é¸­","å‰çƒ§","ç…²ä»”"]},
    {key:"ğŸ› å…¶ä»–",tags:[]},
  ];
  function classify(poi){
    const t=(poi.name+" "+poi.type).toLowerCase();
    for(const c of CUISINE_MAP) if(c.tags.some(tag=>t.includes(tag))) return c.key;
    return "ğŸ› å…¶ä»–";
  }
  const groups={};
  pois.forEach(p=>{const c=classify(p);if(!groups[c])groups[c]=[];groups[c].push(p);});

  let html=`<div style="font-size:13px;font-weight:600;color:var(--pink);margin-bottom:12px;">ğŸ“ é™„è¿‘å¯ä»¥ç‚¹åˆ°ã€Œ${curDish.name}ã€çš„é¤å…</div>`;
  for(const c in groups){
    html+=`<div class="poi-group"><div class="poi-group-title">${c}<span class="poi-count">${groups[c].length}å®¶</span></div>`;
    groups[c].slice(0,4).forEach(p=>{
      html+=`<div class="poi-item">
        <div class="poi-name">${p.name}</div>
        <div class="poi-addr">ğŸ“ ${p.address||p.pname+p.cityname}</div>
        <div class="poi-actions">
          <a href="https://waimai.meituan.com/search/${encodeURIComponent(curDish.name)}" target="_blank" class="a-mt">ğŸ›µ ç¾å›¢ç‚¹ã€Œ${curDish.name}ã€</a>
          <a href="https://www.ele.me/search/${encodeURIComponent(curDish.name)}" target="_blank" class="a-el">ğŸ¥¡ é¥¿äº†ä¹ˆ</a>
        </div>
      </div>`;
    });
    html+="</div>";
  }
  document.getElementById("takeoutResult").innerHTML=html;
  document.getElementById("takeoutResult").scrollIntoView({behavior:"smooth"});
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  åœ¨å®¶åš
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showRecipes(){
  recipeCount++;
  if(recipeCount>=4){document.getElementById("giveupCount").textContent=recipeCount;openGiveup();return;}
  document.getElementById("recipeCounter").textContent=recipeCount>0?`å·²æ¢ ${recipeCount} æ¬¡`:"";
  allRecipes=getRecipes();
  renderRecipes(sortRecipes(allRecipes).slice(0,10));
}
function renderRecipes(list){
  if(!list.length){document.getElementById("recipeResult").innerHTML='<div class="empty">è¯·å…ˆåœ¨âš™ï¸åå¥½ä¸­é€‰æ‹©å®¶ä¹¡</div>';return;}
  let html="";
  list.forEach((r,i)=>{
    const m=getRecipeMatch(r);
    html+=`<div class="recipe-item">
      <div class="recipe-name">${r.name}</div>
      <div class="recipe-badges">
        <span class="badge b-time">â± ${r.time}åˆ†é’Ÿ</span>
        <span class="badge b-diff">ğŸ‘¨â€ğŸ³ ${r.difficulty}</span>
        ${r.spicy>0?`<span class="badge b-spicy">${"ğŸŒ¶".repeat(r.spicy)}</span>`:""}
        ${m?`<span class="badge b-match">${m}</span>`:""}
      </div>
      <button class="recipe-toggle" onclick="toggleDetail(${i},this)">ğŸ“– æŸ¥çœ‹è¯¦ç»†é£Ÿè°± â–¼</button>
      <div class="recipe-detail" id="rd${i}">
        <div class="recipe-section"><h4>ğŸ¥˜ é£Ÿæ</h4><ul>${r.ingredients.map(x=>`<li>${x}</li>`).join("")}</ul></div>
        <div class="recipe-section"><h4>ğŸ‘¨â€ğŸ³ åšæ³•</h4><ul>${r.steps.map((s,n)=>`<li><b>${n+1}.</b> ${s}</li>`).join("")}</ul></div>
        ${r.tips?`<div class="recipe-tip">ğŸ’¡ ${r.tips}</div>`:""}
      </div>
    </div>`;
  });
  document.getElementById("recipeResult").innerHTML=html;
}
function toggleDetail(i,btn){
  const d=document.getElementById("rd"+i);
  d.classList.toggle("open");
  btn.textContent=d.classList.contains("open")?"ğŸ“– æ”¶èµ·é£Ÿè°± â–²":"ğŸ“– æŸ¥çœ‹è¯¦ç»†é£Ÿè°± â–¼";
}
function sortRecipes(list){
  return[...list].sort((a,b)=>{
    let sa=0,sb=0;
    if(prefs.spicy==="ä¸åƒè¾£"){sa-=a.spicy*3;sb-=b.spicy*3;}
    if(prefs.diet==="å‡è„‚ä¸­"){if(/è’¸|æ‹Œ|ç…®/.test(a.name))sa+=4;if(/è’¸|æ‹Œ|ç…®/.test(b.name))sb+=4;}
    prefs.dislikes.forEach(d=>{if(a.ingredients.some(x=>x.includes(d)))sa-=10;if(b.ingredients.some(x=>x.includes(d)))sb-=10;});
    return sb-sa;
  });
}
function getRecipeMatch(r){
  const t=[];
  if(curMode==="couple"&&r.difficulty==="ç®€å•")t.push("ğŸ’‘ é€‚åˆä¸€èµ·åš");
  if(prefs.spicy==="ä¸åƒè¾£"&&r.spicy===0)t.push("âœ… ä¸è¾£");
  if(prefs.diet==="å‡è„‚ä¸­"&&/è’¸|æ‹Œ|ç…®/.test(r.name))t.push("ğŸ¯ ç¬¦åˆå‡è„‚");
  if(prefs.province&&r.province===prefs.province)t.push("ğŸ  å®¶ä¹¡å‘³");
  return t.join(" Â· ");
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  é€‰æ‹©å›°éš¾å¼¹çª—
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openGiveup(){document.getElementById("giveupModal").classList.add("show");}
function closeGiveup(){document.getElementById("giveupModal").classList.remove("show");}
function restartAll(){closeGiveup();spinCount=0;recipeCount=0;backHome();}
function randomFinal(){
  closeGiveup();spinCount=0;recipeCount=0;
  if(document.getElementById("cookingSection").style.display!=="none"){
    const r=allRecipes[Math.floor(Math.random()*allRecipes.length)];
    renderRecipes([r]);
  } else {
    const pool=getDishPool(curCategory);
    curDish=pool[Math.floor(Math.random()*pool.length)];
    showDishResult(curDish);
    document.getElementById("searchCounter").textContent="ğŸ² éšæœºå¸®ä½ é€‰äº†ï¼";
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  åå¥½è®¾ç½®
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openSettings(){document.getElementById("settingsModal").classList.add("show");}
function closeSettings(){document.getElementById("settingsModal").classList.remove("show");}
function buildPrefUI(){
  mkBtns("prefDislikes",["é¦™èœ","å†…è„","æµ·é²œ","è¾£æ¤’","æ´‹è‘±","èŠ¹èœ","èŒ„å­","è‹¦ç“œ"],prefs.dislikes,true);
  mkBtns("prefSpicy",["ä¸åƒè¾£","å¾®è¾£","ä¸­è¾£","ç‰¹è¾£"],[prefs.spicy],false);
  mkBtns("prefDiet",["æ­£å¸¸é¥®é£Ÿ","å‡è„‚ä¸­","å¥èº«å¢è‚Œ","ä½ç¢³é¥®é£Ÿ"],[prefs.diet],false);
  if(prefs.province) document.getElementById("prefProvince").value=prefs.province;
}
function mkBtns(id,opts,selected,multi){
  const box=document.getElementById(id); box.innerHTML="";
  opts.forEach(o=>{
    const b=document.createElement("button"); b.className="pref-btn"+(selected.includes(o)?" selected":""); b.textContent=o;
    b.onclick=()=>{if(multi)b.classList.toggle("selected");else{box.querySelectorAll(".pref-btn").forEach(x=>x.classList.remove("selected"));b.classList.add("selected");}};
    box.appendChild(b);
  });
}
function quickSaveProvince(){prefs.province=document.getElementById("prefProvince").value;localStorage.setItem("prefs",JSON.stringify(prefs));updateProvinceLabel();}
function updateProvinceLabel(){document.getElementById("provinceLabel").textContent=prefs.province?prefs.province+"èœ":"å®¶å¸¸èœ";}
function saveSettings(){
  prefs.dislikes=[...document.querySelectorAll("#prefDislikes .selected")].map(b=>b.textContent);
  prefs.spicy=document.querySelector("#prefSpicy .selected")?.textContent||"å¾®è¾£";
  prefs.diet=document.querySelector("#prefDiet .selected")?.textContent||"æ­£å¸¸é¥®é£Ÿ";
  prefs.province=document.getElementById("prefProvince").value;
  localStorage.setItem("prefs",JSON.stringify(prefs));
  updateProvinceLabel();
  closeSettings();
  drawWheel(curCategory);
  alert("âœ… åå¥½å·²ä¿å­˜ï¼");
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  è‡ªå®šä¹‰èœå“
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addCustomDish(){
  const name=document.getElementById("newDishName").value.trim();
  const cat=document.getElementById("newDishCat").value;
  if(!name){alert("è¯·è¾“å…¥èœå“åç§°");return;}
  customDishes.push({name,category:cat});
  localStorage.setItem("customDishes",JSON.stringify(customDishes));
  document.getElementById("newDishName").value="";
  renderCustomDishList();
  drawWheel(curCategory);
  alert(`âœ… ã€Œ${name}ã€å·²æ·»åŠ ï¼`);
}
function deleteCustomDish(i){
  customDishes.splice(i,1);
  localStorage.setItem("customDishes",JSON.stringify(customDishes));
  renderCustomDishList();
  drawWheel(curCategory);
}
function renderCustomDishList(){
  const box=document.getElementById("customDishList");
  if(!customDishes.length){box.innerHTML='<div style="font-size:12px;color:#bbb;padding:6px;">æš‚æ— è‡ªå®šä¹‰èœå“</div>';return;}
  box.innerHTML=customDishes.map((d,i)=>`
    <div class="custom-dish-item">
      <span>âœ¨ ${d.name} <span style="color:#bbb;font-size:11px;">(${d.category})</span></span>
      <button class="del-dish-btn" onclick="deleteCustomDish(${i})">âœ•</button>
    </div>`).join("");
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  èœè°±æ•°æ®åº“
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getRecipes(){
  const p=prefs.province||"é€šç”¨";
  const DB={
    "å·æ¸":[
      {name:"é±¼é¦™è‚‰ä¸",time:25,difficulty:"ç®€å•",spicy:2,province:"å·æ¸",ingredients:["é‡Œè„Šè‚‰ 200g","æœ¨è€³ 50g","èƒ¡èåœ 1æ ¹","é’æ¤’ 1ä¸ª","è‘±å§œè’œ","è±†ç“£é…± 1å‹º"],steps:["è‚‰åˆ‡ä¸è…Œåˆ¶10åˆ†é’Ÿ","æœ¨è€³æ³¡å‘åˆ‡ä¸ï¼Œè”¬èœåˆ‡ä¸","è°ƒé±¼é¦™æ±ï¼šç³–2é†‹1é…±æ²¹1æ·€ç²‰","çƒ­æ²¹æ»‘ç‚’è‚‰ä¸ç››å‡º","ç‚’é¦™è‘±å§œè’œè±†ç“£é…±å‡ºçº¢æ²¹","ä¸‹é…èœç¿»ç‚’å›é”…è‚‰ä¸æ·‹é±¼é¦™æ±"],tips:"ç³–é†‹2:1æ˜¯å…³é”®"},
      {name:"éº»å©†è±†è…",time:20,difficulty:"ç®€å•",spicy:3,province:"å·æ¸",ingredients:["å«©è±†è… 1ç›’","ç‰›è‚‰æœ« 100g","è±†ç“£é…± 2å‹º","èŠ±æ¤’ç²‰ 1å‹º","è‘±å§œè’œ"],steps:["è±†è…åˆ‡å—ç„¯æ°´","ç‚’ç‰›è‚‰æœ«å˜è‰²","åŠ è±†ç“£é…±ç‚’çº¢æ²¹","åŠ æ°´çƒ§å¼€æ”¾è±†è…ç…®5åˆ†é’Ÿ","æ°´æ·€ç²‰å‹¾èŠ¡æ’’èŠ±æ¤’ç²‰è‘±èŠ±"],tips:"èŠ±æ¤’ç²‰æœ€åæ’’æ‰é¦™"},
      {name:"å®«ä¿é¸¡ä¸",time:20,difficulty:"ä¸­ç­‰",spicy:2,province:"å·æ¸",ingredients:["é¸¡èƒ¸è‚‰ 250g","èŠ±ç”Ÿç±³ 80g","å¹²è¾£æ¤’ 10ä¸ª","èŠ±æ¤’ 1å‹º","è‘±å§œè’œ"],steps:["é¸¡è‚‰åˆ‡ä¸è…Œåˆ¶","èŠ±ç”Ÿç‚¸é…¥","è°ƒå®«ä¿æ±","æ»‘ç‚’é¸¡ä¸ç››å‡º","çˆ†é¦™å¹²è¾£æ¤’èŠ±æ¤’","å›é”…é¸¡ä¸æ·‹æ±åŠ èŠ±ç”Ÿ"],tips:"èŠ±ç”Ÿæœ€åæ”¾æ‰è„†"},
      {name:"å›é”…è‚‰",time:35,difficulty:"ä¸­ç­‰",spicy:2,province:"å·æ¸",ingredients:["äº”èŠ±è‚‰ 300g","é’è’œ 3æ ¹","è±†ç“£é…± 2å‹º","è±†è±‰ 1å‹º","é’çº¢æ¤’å„1ä¸ª"],steps:["äº”èŠ±è‚‰ç…®è‡³8æˆç†Ÿåˆ‡è–„ç‰‡","ä¸æ”¾æ²¹ç…¸å‡ºçŒªæ²¹","åŠ è±†ç“£é…±è±†è±‰ç‚’çº¢æ²¹","ä¸‹é’æ¤’è’œç™½ç¿»ç‚’","å›é”…è‚‰ç¿»åŒ€åŠ è’œå¶"],tips:"è±†ç“£é…±ç‚’å‡ºçº¢æ²¹æ˜¯å…³é”®"},
      {name:"æ°´ç…®è‚‰ç‰‡",time:25,difficulty:"ä¸­ç­‰",spicy:3,province:"å·æ¸",ingredients:["é‡Œè„Šè‚‰ 250g","ç™½èœ 200g","è±†èŠ½ 100g","å¹²è¾£æ¤’ 15ä¸ª","èŠ±æ¤’ 2å‹º","è±†ç“£é…± 2å‹º"],steps:["è‚‰ç‰‡åŠ è›‹æ¸…æ·€ç²‰è…Œåˆ¶","ç™½èœè±†èŠ½ç„¯æ°´é“ºåº•","ç‚’è±†ç“£é…±åŠ æ°´çƒ§å¼€","è‚‰ç‰‡ä¸‹é”…ç…®ç†Ÿ","é“ºå¹²è¾£æ¤’èŠ±æ¤’æµ‡çƒ­æ²¹"],tips:"æœ€åæµ‡çƒ­æ²¹æ˜¯çµé­‚"},
    ],
    "å¹¿ä¸œ":[
      {name:"ç™½åˆ‡é¸¡",time:40,difficulty:"ç®€å•",spicy:0,province:"å¹¿ä¸œ",ingredients:["ä¸‰é»„é¸¡ 1åª","å§œ 50g","è‘± 2æ ¹","æ–™é…’","è’¸é±¼è±‰æ²¹"],steps:["é¸¡è‚šå¡å§œè‘±","å¼€æ°´åŠ å§œè‘±æ–™é…’ä¸‹é¸¡","çƒ§å¼€å°ç«15åˆ†é’Ÿ","ç„–15åˆ†é’Ÿæå‡ºè¿‡å†°æ°´","åˆ‡å—è°ƒè˜¸æ–™"],tips:"å†°æ°´è®©é¸¡çš®çˆ½æ»‘"},
      {name:"è’œè“‰è’¸è™¾",time:15,difficulty:"ç®€å•",spicy:0,province:"å¹¿ä¸œ",ingredients:["åŸºå›´è™¾ 500g","è’œ 1å¤´","ç²‰ä¸ 1æŠŠ","è’¸é±¼è±‰æ²¹ 2å‹º"],steps:["è™¾å‰ªé¡»å¼€èƒŒ","ç²‰ä¸æ³¡è½¯é“ºåº•","é‡‘é“¶è’œé“ºè™¾","å¤§ç«è’¸5åˆ†é’Ÿ","æ·‹è±‰æ²¹æ’’è‘±èŠ±"],tips:"ä¸è¦è’¸å¤ªä¹…"},
      {name:"å¹²ç‚’ç‰›æ²³",time:15,difficulty:"ä¸­ç­‰",spicy:0,province:"å¹¿ä¸œ",ingredients:["æ²³ç²‰ 400g","ç‰›è‚‰ 150g","è±†èŠ½ 100g","éŸ­é»„ 50g","ç”ŸæŠ½è€æŠ½"],steps:["ç‰›è‚‰åŠ å°è‹æ‰“è…Œåˆ¶","æ²³ç²‰æ’•æ•£","å¤§ç«æ»‘ç‚’ç‰›è‚‰ç››å‡º","ä¸‹æ²³ç²‰ç¿»ç‚’ä¸Šè‰²","åŠ è±†èŠ½éŸ­é»„å›é”…ç‰›è‚‰ç‚’åŒ€"],tips:"å…¨ç¨‹å¤§ç«å¿«ç‚’"},
      {name:"æ¸…è’¸é²ˆé±¼",time:20,difficulty:"ç®€å•",spicy:0,province:"å¹¿ä¸œ",ingredients:["é²ˆé±¼ 1æ¡","å§œ 30g","è‘± 2æ ¹","è’¸é±¼è±‰æ²¹ 3å‹º"],steps:["é±¼åˆ’åˆ€è…Œåˆ¶","å§œè‘±é“ºé±¼","æ°´å¼€å¤§ç«è’¸8åˆ†é’Ÿ","å€’æ‰è’¸æ°´é‡é“ºå§œè‘±","æ·‹è±‰æ²¹æµ‡çƒ­æ²¹"],tips:"è’¸å‡ºçš„æ°´è¦å€’æ‰å»è…¥"},
    ],
    "å¹¿è¥¿":[
      {name:"æŸ æª¬é¸­",time:50,difficulty:"ä¸­ç­‰",spicy:1,province:"å¹¿è¥¿",ingredients:["é¸­è‚‰ 500g","é…¸æŸ æª¬ 3ä¸ª","é…¸å§œ 50g","ç´«è‹ 20g","è’œ"],steps:["é¸­è‚‰æ–©å—ç„¯æ°´","çˆ†é¦™è’œå§œ","ä¸‹é¸­è‚‰ç¿»ç‚’é‡‘é»„","åŠ é…¸æŸ æª¬é…¸å§œ","åŠ æ°´ç„–30åˆ†é’Ÿ","æ”¶æ±åŠ ç´«è‹"],tips:"ç´«è‹æ˜¯çµé­‚"},
      {name:"èºè›³ç²‰ï¼ˆå®¶åº­ç‰ˆï¼‰",time:30,difficulty:"ç®€å•",spicy:2,province:"å¹¿è¥¿",ingredients:["èºè›³ç²‰æ–™åŒ… 1å¥—","è…ç«¹","é…¸ç¬‹","èŠ±ç”Ÿ","æœ¨è€³"],steps:["æŒ‰åŒ…è£…ç…®æ±¤åº•","è…ç«¹èŠ±ç”Ÿç‚¸è‡³é‡‘é»„","é…¸ç¬‹æœ¨è€³ç„¯æ°´","ç²‰ç…®è½¯","åŠ æ±¤åº•é…èœè‘±èŠ±è¾£æ¤’æ²¹"],tips:"æ±¤åº•è¦æµ“æ‰å¤Ÿå‘³"},
      {name:"ç™½æ–©é¸¡è˜¸ç´«è‹é…±",time:35,difficulty:"ç®€å•",spicy:0,province:"å¹¿è¥¿",ingredients:["åœŸé¸¡ åŠåª","ç´«è‹ 50g","è’œ 5ç“£","å°ç±³æ¤’ 3ä¸ª","ç”ŸæŠ½æŸ æª¬æ±"],steps:["åœŸé¸¡å†·æ°´ç…®ç†Ÿè¿‡å†°æ°´åˆ‡å—","ç´«è‹è’œå°ç±³æ¤’å‰ç¢","åŠ ç”ŸæŠ½æŸ æª¬æ±è°ƒé…±","è˜¸æ–™é£Ÿç”¨"],tips:"ç´«è‹è˜¸æ–™æ˜¯å¹¿è¥¿ç‰¹è‰²"},
      {name:"è€å‹çŒªæ‚ç²‰",time:30,difficulty:"ä¸­ç­‰",spicy:2,province:"å¹¿è¥¿",ingredients:["çŒªæ‚ 200g","ç±³ç²‰ 200g","è±†è±‰ 1å‹º","é…¸ç¬‹ 50g","å°ç±³æ¤’ 5ä¸ª","ç•ªèŒ„"],steps:["çŒªæ‚ç„¯æ°´åˆ‡ç‰‡","çˆ†é¦™è±†è±‰å°ç±³æ¤’","ä¸‹ç•ªèŒ„é…¸ç¬‹ç‚’é¦™","åŠ æ°´çƒ§å¼€","ä¸‹çŒªæ‚ç…®ç†Ÿ","æ”¾ç±³ç²‰ç…®è½¯"],tips:"è±†è±‰æ˜¯è€å‹ç²‰çš„çµé­‚"},
      {name:"çƒ¤çŒªè¹„",time:90,difficulty:"ä¸­ç­‰",spicy:1,province:"å¹¿è¥¿",ingredients:["çŒªè¹„ 1åª","å—ä¹³ 2å—","è’œ 1å¤´","äº”é¦™ç²‰","èœ‚èœœ 2å‹º"],steps:["çŒªè¹„ç„¯æ°´","å—ä¹³è’œäº”é¦™ç²‰æ¶‚æŠ¹è…Œ2å°æ—¶","200åº¦çƒ¤30åˆ†é’Ÿ","åˆ·èœ‚èœœå†çƒ¤20åˆ†é’Ÿ"],tips:"å¤šåˆ·å‡ æ¬¡èœ‚èœœçš®æ›´è„†"},
    ],
    "æ±Ÿæµ™æ²ª":[
      {name:"çº¢çƒ§è‚‰",time:60,difficulty:"ä¸­ç­‰",spicy:0,province:"æ±Ÿæµ™æ²ª",ingredients:["äº”èŠ±è‚‰ 500g","å†°ç³– 30g","å…«è§’","æ¡‚çš®","ç”ŸæŠ½ 3å‹º","è€æŠ½"],steps:["äº”èŠ±è‚‰åˆ‡å—ç„¯æ°´","ç‚’å†°ç³–è‡³ç„¦ç³–è‰²","ä¸‹è‚‰å—ä¸Šè‰²","åŠ è°ƒæ–™å¼€æ°´å°ç«ç‚–40åˆ†é’Ÿ","å¤§ç«æ”¶æ±"],tips:"ç‚–åˆ°ç­·å­èƒ½è½»æ¾æ’å…¥"},
      {name:"ç³–é†‹å°æ’",time:40,difficulty:"ä¸­ç­‰",spicy:0,province:"æ±Ÿæµ™æ²ª",ingredients:["å°æ’ 500g","ç³– 4å‹º","é†‹ 3å‹º","ç”ŸæŠ½ 2å‹º"],steps:["å°æ’ç„¯æ°´","ä¸¤é¢ç…è‡³é‡‘é»„","åŠ æ°´ç‚–20åˆ†é’Ÿ","å€’ç³–é†‹æ±æ”¶æ±"],tips:"ç³–é†‹4:3:2æœ€ç»å…¸"},
      {name:"æ¸…è’¸å¤§é—¸èŸ¹",time:20,difficulty:"ç®€å•",spicy:0,province:"æ±Ÿæµ™æ²ª",ingredients:["å¤§é—¸èŸ¹ 4åª","å§œ 30g","é†‹","ç”Ÿå§œæœ«"],steps:["èƒèŸ¹åˆ·æ´—å¹²å‡€","è…¹éƒ¨æœä¸Šä¸Šé”…","æ°´å¼€å¤§ç«è’¸15åˆ†é’Ÿ","è°ƒå§œé†‹æ±è˜¸é£Ÿ"],tips:"è‚šå­æœä¸Šè’¸é˜²æ­¢èŸ¹é»„æµå¤±"},
    ],
    "ä¸œåŒ—":[
      {name:"é”…åŒ…è‚‰",time:30,difficulty:"ä¸­ç­‰",spicy:0,province:"ä¸œåŒ—",ingredients:["çŒªé‡Œè„Š 300g","æ·€ç²‰","é†‹ 3å‹º","ç³– 2å‹º","èƒ¡èåœä¸"],steps:["è‚‰åˆ‡ç‰‡è£¹æ·€ç²‰","æ²¹ç‚¸è‡³é‡‘é»„é…¥è„†","è°ƒç³–é†‹æ±","é”…ä¸­ä¸‹èƒ¡èåœä¸","å€’å…¥ç³–é†‹æ±","æ”¾è‚‰ç‰‡ç¿»åŒ€"],tips:"è¦ç‚¸ä¸¤éæ‰é…¥è„†"},
      {name:"ä¸œåŒ—é…¸èœç‚–ç²‰æ¡",time:40,difficulty:"ç®€å•",spicy:0,province:"ä¸œåŒ—",ingredients:["é…¸èœ 300g","ç²‰æ¡ 100g","äº”èŠ±è‚‰ 200g","è‘±å§œ"],steps:["äº”èŠ±è‚‰åˆ‡ç‰‡ç‚’å‡ºæ²¹","ä¸‹è‘±å§œç‚’é¦™","åŠ é…¸èœç¿»ç‚’","åŠ æ°´çƒ§å¼€","ä¸‹ç²‰æ¡ç‚–20åˆ†é’Ÿ","è°ƒå‘³"],tips:"é…¸èœæå‰æ¸…æ´—å»å¤šä½™é…¸å‘³"},
    ],
    "é€šç”¨":[
      {name:"ç•ªèŒ„ç‚’è›‹",time:10,difficulty:"ç®€å•",spicy:0,province:"é€šç”¨",ingredients:["é¸¡è›‹ 3ä¸ª","ç•ªèŒ„ 2ä¸ª","ç³– 1å‹º"],steps:["è›‹æ‰“æ•£åŠ ç›","ç•ªèŒ„åˆ‡å—","ç‚’è›‹åŠç†Ÿç››å‡º","ç‚’ç•ªèŒ„å‡ºæ±åŠ ç³–","å›é”…è›‹ç¿»åŒ€"],tips:"åŠ ä¸€ç‚¹ç³–æé²œ"},
      {name:"é’æ¤’åœŸè±†ä¸",time:15,difficulty:"ç®€å•",spicy:1,province:"é€šç”¨",ingredients:["åœŸè±† 2ä¸ª","é’æ¤’ 1ä¸ª","è’œ","é†‹"],steps:["åœŸè±†åˆ‡ä¸æ³¡æ°´","çˆ†é¦™è’œæœ«","ä¸‹åœŸè±†ä¸åŠ é†‹","ä¸‹é’æ¤’ç‚’åŒ€"],tips:"æ³¡æ°´å»æ·€ç²‰æ‰è„†"},
      {name:"è’œè“‰è¥¿å…°èŠ±",time:10,difficulty:"ç®€å•",spicy:0,province:"é€šç”¨",ingredients:["è¥¿å…°èŠ± 1ä¸ª","è’œ 5ç“£","èšæ²¹"],steps:["è¥¿å…°èŠ±ç„¯æ°´1åˆ†é’Ÿ","çˆ†é¦™è’œæœ«","ä¸‹è¥¿å…°èŠ±åŠ èšæ²¹"],tips:"ç„¯æ°´åŠ ç›åŠ æ²¹é¢œè‰²æ›´ç»¿"},
      {name:"è›‹ç‚’é¥­",time:10,difficulty:"ç®€å•",spicy:0,province:"é€šç”¨",ingredients:["éš”å¤œç±³é¥­ 2ç¢—","é¸¡è›‹ 2ä¸ª","è‘±","ç”ŸæŠ½"],steps:["è›‹æ‰“æ•£","ç‚’è›‹ç¢ç››å‡º","ä¸‹ç±³é¥­ç¿»ç‚’æ•£å¼€","åŠ ç”ŸæŠ½ç›","å›é”…è›‹åŠ è‘±èŠ±"],tips:"éš”å¤œé¥­ç²’ç²’åˆ†æ˜"},
      {name:"é…±ç‰›è‚‰",time:90,difficulty:"ç®€å•",spicy:0,province:"é€šç”¨",ingredients:["ç‰›è…±è‚‰ 500g","ç”ŸæŠ½","è€æŠ½","å…«è§’","æ¡‚çš®","é¦™å¶"],steps:["ç‰›è‚‰å†·æ°´ç„¯æ°´","åŠ æ‰€æœ‰è°ƒæ–™åŠ æ°´æ²¡è¿‡ç‰›è‚‰","å¤§ç«çƒ§å¼€è½¬å°ç«ç‚–60åˆ†é’Ÿ","è‡ªç„¶å†·å´åˆ‡ç‰‡"],tips:"å†·é€ååˆ‡ç‰‡æ›´æ•´é½"},
    ],
  };
  return DB[p]||DB["é€šç”¨"];
}
</script>
</body>
</html>
